<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<ns1:Envelope xmlns:ns1="http://servicemesh.com/agility/api" xmlns:ns2="http://servicemesh.com/core/messaging" ns1:version="3.0" ns1:productVersion="9.2.4">
    <ns1:pendingAsset xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="ns1:Script">
        <ns1:name>MWS2R2 - AD Global Repository</ns1:name>
        <ns1:id>132</ns1:id>
        <ns1:description></ns1:description>
        <ns1:uuid>ee120368-cb3c-4a63-8111-47a37c1bdf42</ns1:uuid>
        <ns1:assetType>
            <ns1:name>script</ns1:name>
            <ns1:href>assettype/2</ns1:href>
            <ns1:id>2</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.AssetType+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:assetType>
        <ns1:top>false</ns1:top>
        <ns1:assetPath>/Root/MWS2/MWS2_CDCR2/LYNCSANDPIT (sandpit3.local)</ns1:assetPath>
        <ns1:detailedAssetPath>/Root:#ID#1:#TYPE#VMContainer/MWS2:#ID#8:#TYPE#VMContainer/MWS2_CDCR2:#ID#9:#TYPE#VMProject/LYNCSANDPIT (sandpit3.local):#ID#217:#TYPE#VMEnvironment</ns1:detailedAssetPath>
        <ns1:lifecycleVersion>-1</ns1:lifecycleVersion>
        <ns1:removable>true</ns1:removable>
        <ns1:domain>
            <ns1:name>domain1</ns1:name>
            <ns1:href>domain/1</ns1:href>
            <ns1:id>1</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.Domain+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:domain>
        <ns1:creator>
            <ns1:name>dhatchett-admin</ns1:name>
            <ns1:href>user/14</ns1:href>
            <ns1:id>14</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.User+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:creator>
        <ns1:created>2015-02-10T00:35:37-06:00</ns1:created>
        <ns1:lockType>0</ns1:lockType>
        <ns1:lastModified>2015-04-16T07:31:02-05:00</ns1:lastModified>
        <ns1:parent>
            <ns1:name>LYNCSANDPIT (sandpit3.local)</ns1:name>
            <ns1:href>environment/217</ns1:href>
            <ns1:id>217</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.Environment+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:parent>
        <ns1:slot>7890a1c9-2153-4224-9ca2-e73c1064ab06</ns1:slot>
        <ns1:version>1</ns1:version>
        <ns1:latest>false</ns1:latest>
        <ns1:publishComment></ns1:publishComment>
        <ns1:slotId>186</ns1:slotId>
        <ns1:publisher>
            <ns1:name>admin</ns1:name>
            <ns1:href>user/1</ns1:href>
            <ns1:id>1</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.User+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:publisher>
        <ns1:versionStatus>versioned</ns1:versionStatus>
        <ns1:checkoutAllowed>true</ns1:checkoutAllowed>
        <ns1:headAllowed>true</ns1:headAllowed>
        <ns1:operatingSystem>Windows</ns1:operatingSystem>
        <ns1:enableExtensions>false</ns1:enableExtensions>
        <ns1:body># Support multiple deployment environments
$environment = $ENVIRONMENT

$script = @'
Add-Type -AssemblyName System.Web
function set-globalvariable($key,$val) {
__ENVCODE__
Invoke-WebRequest -Method PUT -Uri http://10.5.4.40:4001/v2/keys/$($key)?value=$([System.Web.HttpUtility]::UrlEncode($($val))) -UseBasicParsing
}

function get-globalvariable($key) {
__ENVCODE__
$resp = Invoke-RestMethod -Method GET -Uri http://10.5.4.40:4001/v2/keys/$key
return $resp.node
}

function get-globalvariable_json($key) {
__ENVCODE__
$resp = Invoke-RestMethod -Method GET -Uri http://10.5.4.40:4001/v2/keys/$key
return ConvertFrom-Json $resp.node.value
}


function connect-deploymentshare{
$share = get-globalvariable 'Global/DeploymentShare'
$username = get-globalvariable 'Global/DeploymentUsername'
$password = get-globalvariable 'Global/DeploymentPassword'

$secure_pwd = convertto-securestring $password.value -asplaintext -force

$dcred = new-object -typename System.Management.Automation.PSCredential `
         -argumentlist $username.value, $secure_pwd
$d=New-PSDrive -Name 'Y' -PSProvider FileSystem -Root $share.value -Credential $dcred -Scope Global -persist 

}

function disconnect-deploymentshare{
$d = Remove-PSDrive -Name 'Y'
}

function get-files($computer){
   connect-deploymentshare
   Copy-Item &quot;y:\Common\*&quot; .\ -Recurse -force -Verbose
    $c = $computer
    if( Test-Path -Path (&quot;y:\&quot; + $c)){
    $p = &quot;y:\&quot; + $c + &quot;\*&quot;
    Copy-Item $p .\ -Recurse -force -Verbose
    }else{
        write-output &quot;computername folder does not exist - $c&quot;
    }
   disconnect-deploymentshare

}

function Get-AppFiles($appname){
   connect-deploymentshare
    $p = &quot;y:\&quot; + $appname + &quot;\*&quot;
    if(Test-Path -Path (&quot;y:\&quot; + $appname)){
        Write-Output &quot;Copying Application files from Y:\$($appname)&quot;
        Copy-Item $p .\ -Recurse -force
    } Else {
        Write-Error &quot;Application folder $appname does not exist&quot; -ErrorAction SilentlyContinue
    }
   disconnect-deploymentshare

}
'@


# Perform a replace on __ENVCODE__ to support multiple AD environments
if($environment -eq $null){
	write-output &quot;Generating script for default environment&quot;
	$script = $script -replace &quot;__ENVCODE__&quot;,&quot;&quot;
}else{
	write-output &quot;Generating script for [$environment] environment&quot;
	$newstring = $('$key= &quot;[' + $environment + ']/$key&quot;')
    	$script = $script -replace &quot;__ENVCODE__&quot;,$newstring
}

$script | out-file &quot;GlobalRepository.ps1&quot;
# Load Common functions
#. .\GlobalRepository.ps1
# download common files and computer specific files
#get-files


</ns1:body>
        <ns1:type>Guest</ns1:type>
        <ns1:language>
            <ns1:name>powershell</ns1:name>
            <ns1:href>scriptlanguage/5</ns1:href>
            <ns1:id>5</ns1:id>
            <ns1:rel>down</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.ScriptLanguage+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:language>
        <ns1:runAsAdmin>false</ns1:runAsAdmin>
        <ns1:timeout>3600</ns1:timeout>
        <ns1:retries>0</ns1:retries>
        <ns1:delay>0</ns1:delay>
        <ns1:errorAction>Continue</ns1:errorAction>
        <ns1:rebootRequired>false</ns1:rebootRequired>
        <ns1:variable>
            <ns1:name>ENVIRONMENT</ns1:name>
            <ns1:id>282</ns1:id>
            <ns1:description></ns1:description>
            <ns1:uuid>2be7a04c-12b8-47bc-9bd0-805fa6c2c041</ns1:uuid>
            <ns1:top>false</ns1:top>
            <ns1:assetPath></ns1:assetPath>
            <ns1:detailedAssetPath></ns1:detailedAssetPath>
            <ns1:lifecycleVersion>-1</ns1:lifecycleVersion>
            <ns1:removable>true</ns1:removable>
            <ns1:displayName>ENVIRONMENT</ns1:displayName>
            <ns1:readable>true</ns1:readable>
            <ns1:writable>true</ns1:writable>
            <ns1:minRequired>0</ns1:minRequired>
            <ns1:maxAllowed>1</ns1:maxAllowed>
            <ns1:validator/>
            <ns1:propertyType>
                <ns1:name>string-any</ns1:name>
                <ns1:href>propertytype/4</ns1:href>
                <ns1:id>4</ns1:id>
                <ns1:type>application/com.servicemesh.agility.api.PropertyType+xml</ns1:type>
            </ns1:propertyType>
            <ns1:assetPropertyLinkId>882764b4-65f6-4f47-a170-9934b4780aee</ns1:assetPropertyLinkId>
        </ns1:variable>
        <ns1:runOnProvisionOnly>false</ns1:runOnProvisionOnly>
    </ns1:pendingAsset>
    <ns1:pendingAsset xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="ns1:Script">
        <ns1:name>MWS2R2 - AD Rename Computer</ns1:name>
        <ns1:id>134</ns1:id>
        <ns1:description></ns1:description>
        <ns1:uuid>408a3959-fbcc-432a-ba76-693e03537ad0</ns1:uuid>
        <ns1:assetType>
            <ns1:name>script</ns1:name>
            <ns1:href>assettype/2</ns1:href>
            <ns1:id>2</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.AssetType+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:assetType>
        <ns1:top>false</ns1:top>
        <ns1:assetPath>/Root/MWS2/MWS2_CDCR2/LYNCSANDPIT (sandpit3.local)</ns1:assetPath>
        <ns1:detailedAssetPath>/Root:#ID#1:#TYPE#VMContainer/MWS2:#ID#8:#TYPE#VMContainer/MWS2_CDCR2:#ID#9:#TYPE#VMProject/LYNCSANDPIT (sandpit3.local):#ID#217:#TYPE#VMEnvironment</ns1:detailedAssetPath>
        <ns1:lifecycleVersion>-1</ns1:lifecycleVersion>
        <ns1:removable>true</ns1:removable>
        <ns1:domain>
            <ns1:name>domain1</ns1:name>
            <ns1:href>domain/1</ns1:href>
            <ns1:id>1</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.Domain+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:domain>
        <ns1:creator>
            <ns1:name>dhatchett-admin</ns1:name>
            <ns1:href>user/14</ns1:href>
            <ns1:id>14</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.User+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:creator>
        <ns1:created>2015-02-10T00:37:48-06:00</ns1:created>
        <ns1:lockType>0</ns1:lockType>
        <ns1:lastModified>2015-04-16T07:31:02-05:00</ns1:lastModified>
        <ns1:parent>
            <ns1:name>LYNCSANDPIT (sandpit3.local)</ns1:name>
            <ns1:href>environment/217</ns1:href>
            <ns1:id>217</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.Environment+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:parent>
        <ns1:slot>c81389ef-c101-4448-a7e4-1804b50696c2</ns1:slot>
        <ns1:version>1</ns1:version>
        <ns1:latest>false</ns1:latest>
        <ns1:publishComment></ns1:publishComment>
        <ns1:slotId>187</ns1:slotId>
        <ns1:publisher>
            <ns1:name>admin</ns1:name>
            <ns1:href>user/1</ns1:href>
            <ns1:id>1</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.User+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:publisher>
        <ns1:versionStatus>versioned</ns1:versionStatus>
        <ns1:checkoutAllowed>true</ns1:checkoutAllowed>
        <ns1:headAllowed>true</ns1:headAllowed>
        <ns1:operatingSystem>Windows</ns1:operatingSystem>
        <ns1:enableExtensions>false</ns1:enableExtensions>
        <ns1:body>#	ScriptName: 	AD Rename Computer
#	Author: 	Mark Freeman
#	Required Variables: COMPONENTID, INSTANCEID
#	Description:
#
#	Renames a computer based on MWS2 naming standard
#	Registers the computername and IP address in the key value store
#	Downloads common and computer specific files from the deployment file share
#	Resets the local administrator account password to a random value
#	Registers the password in the key value share
#	Updates the instance name in AWS


. .\GlobalRepository.ps1


$ComponentID = $COMPONENTID
$InstanceID =  $INSTANCEID

$CustomerID = (get-globalvariable &quot;Global/CustomerID&quot;).value
$LocationID = (get-globalvariable &quot;Global/LocationID&quot;).value

$Computername = $($CustomerID + $ComponentID + $LocationID + $InstanceID + &quot;W&quot;)
write-output &quot;Setting computername to $Computername&quot;
Rename-Computer -NewName $Computername -force

write-output &quot;Storing IP Address in key value store&quot;
$key = 'Network/{0}' -f $Computername
$ip = Get-NetIPAddress | Where-Object -FilterScript {$_.AddressFamily -eq &quot;IPv4&quot; } | Where-Object -FilterScript {$_.IPAddress -ne &quot;127.0.0.1&quot;}
$ipa = $ip.IPAddress
Set-globalvariable $key $ipa

write-output &quot;Downloading common files and computer files from repository&quot;

get-files &quot;$ComponentID$InstanceID&quot;

write-output &quot;Resetting local administrator password&quot;
. .\New-RandomPassword.ps1
$password = new-randompassword -PasswordLength 10
$adminUser = [ADSI] &quot;WinNT://./SOE-LOAD,User&quot;
$adminUser.SetPassword($password)
Set-globalvariable &quot;Administrator/$Computername&quot; $password

#register name tag
#write-output &quot;Registering AWS name tag&quot;
#$aid  = Invoke-RestMethod -Uri http://169.254.169.254/latest/meta-data/instance-id
#$uri = &quot;http://10.0.0.23:5000/p1/&quot; + $aid + &quot;?tagname=&quot; + $Computername 
#Invoke-RestMethod -Uri $uri -Method Put


write-output &quot;Restarting computer&quot;

</ns1:body>
        <ns1:type>Guest</ns1:type>
        <ns1:language>
            <ns1:name>powershell</ns1:name>
            <ns1:href>scriptlanguage/5</ns1:href>
            <ns1:id>5</ns1:id>
            <ns1:rel>down</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.ScriptLanguage+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:language>
        <ns1:runAsAdmin>false</ns1:runAsAdmin>
        <ns1:timeout>3600</ns1:timeout>
        <ns1:retries>0</ns1:retries>
        <ns1:delay>0</ns1:delay>
        <ns1:errorAction>Continue</ns1:errorAction>
        <ns1:rebootRequired>true</ns1:rebootRequired>
        <ns1:variable>
            <ns1:name>COMPONENTID</ns1:name>
            <ns1:id>118</ns1:id>
            <ns1:description>COMPONENTID</ns1:description>
            <ns1:uuid>b8b5a8fe-6f2b-407f-91ae-8970902255b2</ns1:uuid>
            <ns1:top>false</ns1:top>
            <ns1:assetPath></ns1:assetPath>
            <ns1:detailedAssetPath></ns1:detailedAssetPath>
            <ns1:lifecycleVersion>-1</ns1:lifecycleVersion>
            <ns1:removable>true</ns1:removable>
            <ns1:displayName>COMPONENTID</ns1:displayName>
            <ns1:readable>true</ns1:readable>
            <ns1:writable>true</ns1:writable>
            <ns1:minRequired>0</ns1:minRequired>
            <ns1:maxAllowed>1</ns1:maxAllowed>
            <ns1:validator/>
            <ns1:propertyType>
                <ns1:name>string-any</ns1:name>
                <ns1:href>propertytype/4</ns1:href>
                <ns1:id>4</ns1:id>
                <ns1:type>application/com.servicemesh.agility.api.PropertyType+xml</ns1:type>
            </ns1:propertyType>
            <ns1:assetPropertyLinkId>de0200c9-8810-412c-8fd6-0c33775f9bdb</ns1:assetPropertyLinkId>
        </ns1:variable>
        <ns1:variable>
            <ns1:name>INSTANCEID</ns1:name>
            <ns1:id>119</ns1:id>
            <ns1:description>INSTANCEID</ns1:description>
            <ns1:uuid>1ff79879-031b-4e6c-b5c4-5d8b0b8af0e6</ns1:uuid>
            <ns1:top>false</ns1:top>
            <ns1:assetPath></ns1:assetPath>
            <ns1:detailedAssetPath></ns1:detailedAssetPath>
            <ns1:lifecycleVersion>-1</ns1:lifecycleVersion>
            <ns1:removable>true</ns1:removable>
            <ns1:displayName>INSTANCEID</ns1:displayName>
            <ns1:readable>true</ns1:readable>
            <ns1:writable>true</ns1:writable>
            <ns1:minRequired>0</ns1:minRequired>
            <ns1:maxAllowed>1</ns1:maxAllowed>
            <ns1:validator/>
            <ns1:propertyType>
                <ns1:name>string-any</ns1:name>
                <ns1:href>propertytype/4</ns1:href>
                <ns1:id>4</ns1:id>
                <ns1:type>application/com.servicemesh.agility.api.PropertyType+xml</ns1:type>
            </ns1:propertyType>
            <ns1:assetPropertyLinkId>24d648a9-5594-414a-8982-443a1d37910d</ns1:assetPropertyLinkId>
        </ns1:variable>
        <ns1:runOnProvisionOnly>false</ns1:runOnProvisionOnly>
    </ns1:pendingAsset>
    <ns1:pendingAsset xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="ns1:Script">
        <ns1:name>MWS2R2 - AD Create Active Directory</ns1:name>
        <ns1:id>131</ns1:id>
        <ns1:description></ns1:description>
        <ns1:uuid>9f8019ff-6d44-47ba-beb1-c0a5182383e6</ns1:uuid>
        <ns1:assetType>
            <ns1:name>script</ns1:name>
            <ns1:href>assettype/2</ns1:href>
            <ns1:id>2</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.AssetType+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:assetType>
        <ns1:top>false</ns1:top>
        <ns1:assetPath>/Root/MWS2/MWS2_CDCR2</ns1:assetPath>
        <ns1:detailedAssetPath>/Root:#ID#1:#TYPE#VMContainer/MWS2:#ID#8:#TYPE#VMContainer/MWS2_CDCR2:#ID#9:#TYPE#VMProject</ns1:detailedAssetPath>
        <ns1:lifecycleVersion>-1</ns1:lifecycleVersion>
        <ns1:removable>true</ns1:removable>
        <ns1:domain>
            <ns1:name>domain1</ns1:name>
            <ns1:href>domain/1</ns1:href>
            <ns1:id>1</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.Domain+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:domain>
        <ns1:creator>
            <ns1:name>dhatchett-admin</ns1:name>
            <ns1:href>user/14</ns1:href>
            <ns1:id>14</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.User+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:creator>
        <ns1:created>2015-02-10T00:34:19-06:00</ns1:created>
        <ns1:lockType>0</ns1:lockType>
        <ns1:lastModified>2015-03-24T05:18:48-05:00</ns1:lastModified>
        <ns1:parent>
            <ns1:name>MWS2_CDCR2</ns1:name>
            <ns1:href>project/9</ns1:href>
            <ns1:id>9</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.Project+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:parent>
        <ns1:version>-1</ns1:version>
        <ns1:latest>false</ns1:latest>
        <ns1:versionStatus>inprogress</ns1:versionStatus>
        <ns1:checkoutAllowed>false</ns1:checkoutAllowed>
        <ns1:headAllowed>false</ns1:headAllowed>
        <ns1:operatingSystem>Windows</ns1:operatingSystem>
        <ns1:enableExtensions>false</ns1:enableExtensions>
        <ns1:body>#	ScriptName: 	AD Create Active Directory
#	Author: 	Mark Freeman
#	Required Variables: None
#	Description:
#
#	Installs Active Directory Role and Management Tools
#	Runs DC Promo to create the resource domain
#	Registers the DCs IP address in the key value store as Primary DNS server



#include dynamic data store
# Load Common functions
. .\Logging.ps1
. .\GlobalRepository.ps1
. .\LaunchProcess.ps1
. .\FilesUtility.ps1


write-output &quot;Installing Active Roles Management.&quot;
Start-Process &quot;msiexec.exe&quot; -ArgumentList &quot;-i $scriptPath\ActiveRolesManagementShell_x64_1.6.0.msi /q&quot;-Wait
write-output &quot;Active Roles Management installed.&quot;


#install roles and features

$addsTools = &quot;RSAT-AD-Tools&quot;

Add-WindowsFeature $addsTools
#Install AD DS, DNS and GPMC

start-job -Name addFeature -ScriptBlock {
  Add-WindowsFeature -Name &quot;ad-domain-services&quot; -IncludeAllSubFeature -IncludeManagementTools                                                                  
  Add-WindowsFeature -Name &quot;dns&quot; -IncludeAllSubFeature -IncludeManagementTools                                    
  Add-WindowsFeature -Name &quot;gpmc&quot; -IncludeAllSubFeature -IncludeManagementTools   }
Wait-Job -Name addFeature


# Create New Forest, add Domain Controller

$domainname = (get-globalvariable &quot;Global/DomainFQDN&quot;).value
$netbiosName = (get-globalvariable &quot;Global/DomainNetBIOS&quot;).value
$dsrmPassword = (get-globalvariable &quot;Global/DomainDSRMPassword&quot;).value
$secure_string_pwd = convertto-securestring $dsrmPassword -asplaintext -force


write-output &quot;Domainname: $domainname [$netbiosname]&quot;


  Import-Module ADDSDeployment
  Install-ADDSForest -CreateDnsDelegation:$false `
   -DatabasePath &quot;E:\NTDS-DB&quot; `
   -DomainMode &quot;Win2012&quot; `
   -DomainName $domainname `
   -DomainNetbiosName $netbiosName `
   -SafeModeAdministratorPassword $secure_string_pwd `
   -ForestMode &quot;Win2012&quot; `
   -InstallDns:$true `
   -LogPath &quot;L:\NTDS-Logs&quot; `
   -NoRebootOnCompletion:$true `
   -SysvolPath &quot;E:\SYSVOL&quot; `
   -Force:$true  `


$dynamicdata = &quot;AD\PrimaryDNS&quot;
$ip = Get-NetIPAddress | Where-Object -FilterScript {$_.AddressFamily -eq &quot;IPv4&quot; } | Where-Object -FilterScript {$_.IPAddress -ne &quot;127.0.0.1&quot;}
$ipa = $ip.IPAddress
Set-globalvariable $dynamicdata $ipa


write-output &quot;Sleeping for 2 minutes&quot;
Start-Sleep -s 120
write-output &quot;Done&quot;

</ns1:body>
        <ns1:type>Guest</ns1:type>
        <ns1:language>
            <ns1:name>powershell</ns1:name>
            <ns1:href>scriptlanguage/5</ns1:href>
            <ns1:id>5</ns1:id>
            <ns1:rel>down</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.ScriptLanguage+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:language>
        <ns1:runAsAdmin>false</ns1:runAsAdmin>
        <ns1:timeout>3600</ns1:timeout>
        <ns1:retries>0</ns1:retries>
        <ns1:delay>0</ns1:delay>
        <ns1:errorAction>Continue</ns1:errorAction>
        <ns1:rebootRequired>true</ns1:rebootRequired>
        <ns1:runOnProvisionOnly>false</ns1:runOnProvisionOnly>
    </ns1:pendingAsset>
    <ns1:pendingAsset xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="ns1:Script">
        <ns1:name>MWS2R2 - AD Configure Active Directory</ns1:name>
        <ns1:id>130</ns1:id>
        <ns1:description></ns1:description>
        <ns1:uuid>110472a7-0157-415e-b394-dbf831e9253d</ns1:uuid>
        <ns1:assetType>
            <ns1:name>script</ns1:name>
            <ns1:href>assettype/2</ns1:href>
            <ns1:id>2</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.AssetType+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:assetType>
        <ns1:top>false</ns1:top>
        <ns1:assetPath>/Root/MWS2/MWS2_CDCR2</ns1:assetPath>
        <ns1:detailedAssetPath>/Root:#ID#1:#TYPE#VMContainer/MWS2:#ID#8:#TYPE#VMContainer/MWS2_CDCR2:#ID#9:#TYPE#VMProject</ns1:detailedAssetPath>
        <ns1:lifecycleVersion>-1</ns1:lifecycleVersion>
        <ns1:removable>true</ns1:removable>
        <ns1:domain>
            <ns1:name>domain1</ns1:name>
            <ns1:href>domain/1</ns1:href>
            <ns1:id>1</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.Domain+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:domain>
        <ns1:creator>
            <ns1:name>dhatchett-admin</ns1:name>
            <ns1:href>user/14</ns1:href>
            <ns1:id>14</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.User+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:creator>
        <ns1:created>2015-02-10T00:31:15-06:00</ns1:created>
        <ns1:lockType>0</ns1:lockType>
        <ns1:lastModified>2015-04-22T23:27:54-05:00</ns1:lastModified>
        <ns1:parent>
            <ns1:name>MWS2_CDCR2</ns1:name>
            <ns1:href>project/9</ns1:href>
            <ns1:id>9</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.Project+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:parent>
        <ns1:version>-1</ns1:version>
        <ns1:latest>false</ns1:latest>
        <ns1:versionStatus>inprogress</ns1:versionStatus>
        <ns1:checkoutAllowed>false</ns1:checkoutAllowed>
        <ns1:headAllowed>false</ns1:headAllowed>
        <ns1:operatingSystem>Windows</ns1:operatingSystem>
        <ns1:enableExtensions>false</ns1:enableExtensions>
        <ns1:body>#	ScriptName: 	AD Configure Active Directory
#	Author: 	Mark Freeman
#	Required Variables: None
#	Description:
#
#	Creates OU Structure
#	Creates Service Accounts and stores passwords in key value store
#	Store domain dn in key value store for later use

. .\GlobalRepository.ps1
. .\new-randompassword.ps1
Start-Sleep -s 120

$scriptPath = split-path -parent $MyInvocation.MyCommand.Definition
$scriptName = $MyInvocation.MyCommand.Name
#Saving Domain Details in key-value store

$d = get-addomain
Set-GlobalVariable &quot;AD/DistinguishedName&quot; $d.DistinguishedName

write-output &quot;Installing Active Roles Management.&quot;
Start-Process &quot;msiexec.exe&quot; -ArgumentList &quot;-i $scriptPath\ActiveRolesManagementShell_x64_1.6.0.msi /q&quot;-Wait
write-output &quot;Active Roles Management installed.&quot;


. .\1_MWS_OUimport.ps1
. .\2_MWS_PERMGroupsPerOU.ps1
. .\3_MWS_ApplyPERMGroupstoOU.ps1


$username = (get-globalvariable &quot;Global\DeploymentUsername&quot;).value
$description = &quot;Agility Deployment Account&quot;
$password = (get-globalvariable &quot;Global\DeploymentPassword&quot;).value

function CreateServiceAccount([string]$username, [string]$description,[string]$password){

    if(!$password){
	$password = new-randompassword -PasswordLength 16
	}

    $User = Get-ADUser -Filter {sAMAccountName  -eq $username}
    If ($User  -eq $Null) {&quot;User does not currently exist in AD&quot;}
    Else {
        &quot;[SKIP] User found in AD&quot;
        return
    }

    $dom = Get-ADDomain
    $dn = $dom.DistinguishedName
 
  
    New-ADUser $username `
    -Path &quot;ou=admin service accounts,ou=Administration,$dn&quot; `
    -Enable:$true `
    -PasswordNeverExpires:$true `
    -Description $description `
    -AccountPassword (ConvertTo-SecureString $password -AsPlainText -Force)

	Set-GlobalVariable &quot;ServiceAccount/$username&quot; $password
	
}

function AddUsertoDomainGroup([string]$username, [string]$groupname){

   Add-ADGroupMember $groupname $username
}


$scriptPath = split-path -parent $MyInvocation.MyCommand.Definition
$scriptName = $MyInvocation.MyCommand.Name

write-output &quot;Adding AD management tools if required.&quot;
$addsTools = &quot;RSAT-AD-Tools&quot;
Add-WindowsFeature $addsTools

Import-Module ActiveDirectory

CreateServiceAccount -username $username -description $description -password $password
CreateServiceAccount -username &quot;aws_mws_em_admin&quot; -description &quot;SQL - EM&quot; 
CreateServiceAccount -username &quot;svc_sp_sql&quot; -description &quot;SQL - Sharepoint&quot; 
CreateServiceAccount -username &quot;svc_sp_ssas&quot; -description &quot;SSAS - Sharepoint&quot; 
CreateServiceAccount -username &quot;svc_sp_ssis&quot; -description &quot;SSIS - Sharepoint&quot;
CreateServiceAccount -username &quot;svc_sp_ssrs&quot; -description &quot;SSRS - Sharepoint&quot;
CreateServiceAccount -username &quot;svc_sp_farm&quot; -description &quot;Sharepoint&quot;
CreateServiceAccount -username &quot;svc_sp_Services&quot; -description &quot;Sharepoint&quot;
CreateServiceAccount -username &quot;svc_sp_WebAppPool&quot; -description &quot;Sharepoint&quot;
CreateServiceAccount -username &quot;svc_sp_Content&quot; -description &quot;Sharepoint&quot;
CreateServiceAccount -username &quot;svc_sp_UserProfile&quot; -description &quot;Sharepoint&quot;
CreateServiceAccount -username &quot;svc_sp_SuperUser&quot; -description &quot;Sharepoint&quot;
CreateServiceAccount -username &quot;svc_sp_SuperReader&quot; -description &quot;Sharepoint&quot;
CreateServiceAccount -username &quot;svc_sp_Excel&quot; -description &quot;Sharepoint&quot;
CreateServiceAccount -username &quot;svc_sp_PerfPoint&quot; -description &quot;Sharepoint&quot;
CreateServiceAccount -username &quot;svc_sp_Access&quot; -description &quot;Sharepoint&quot;
CreateServiceAccount -username &quot;svc_sp_Workflow&quot; -description &quot;Sharepoint&quot;
CreateServiceAccount -username &quot;svc_sql&quot; -description &quot;Generic SQL&quot;
CreateServiceAccount -username &quot;svc-sharefile&quot; -description &quot;Sharefile Service Account&quot;
CreateServiceAccount -username &quot;service.exchange&quot; -description &quot;Exchange Service Account&quot;
CreateServiceAccount -username &quot;svc_sccm_install&quot; -description &quot;SCCM Service Account&quot;
CreateServiceAccount -username &quot;svc_sccm_sql&quot; -description &quot;SCCM SQL Account&quot;
CreateServiceAccount -username &quot;svc_sccm_sup&quot; -description &quot;SCCM SUP Account&quot;
CreateServiceAccount -username &quot;svc_em_install&quot; -description &quot;EM install Account&quot;
CreateServiceAccount -username &quot;svc_fim&quot; -description &quot;FIM Service Account&quot;
CreateServiceAccount -username &quot;svc_xdm&quot; -description &quot;XDM Service Account&quot;
CreateServiceAccount -username &quot;svc_sp_search&quot; -description &quot;Sharepoint Service Account&quot;
CreateServiceAccount -username &quot;svc_sp_visio&quot; -description &quot;Sharepoint Service Account&quot;
CreateServiceAccount -username &quot;svc_mysitesapppool&quot; -description &quot;Sharepoint Service Account&quot;
CreateServiceAccount -username &quot;z-da-sql-omdwritr&quot; -description &quot;SCOM Service Account&quot;
CreateServiceAccount -username &quot;z-da-sql-omdredr&quot; -description &quot;SCOM Service Account&quot;
CreateServiceAccount -username &quot;z-da-om-csda&quot; -description &quot;SCOM Service Account&quot;
CreateServiceAccount -username &quot;z-da-omsrva&quot; -description &quot;SCOM Service Account&quot;

AddUserToDomainGroup &quot;service.exchange&quot; &quot;enterprise admins&quot;
AddUserToDomainGroup &quot;service.exchange&quot; &quot;domain admins&quot;
AddUserToDomainGroup &quot;service.exchange&quot; &quot;enterprise admins&quot;
AddUserToDomainGroup &quot;service.exchange&quot; &quot;schema admins&quot;
AddUserToDomainGroup &quot;svc_sccm_install&quot; &quot;schema admins&quot;

AddUserToDomainGroup $username &quot;domain admins&quot;

# Agility user must be enterprise admin for recycle bin enable
$currentuser = &quot;$env:USERNAME&quot;
AddUserToDomainGroup $currentuser &quot;enterprise admins&quot;
AddUserToDomainGroup $currentuser &quot;schema admins&quot;

Exit $LastExitCode


</ns1:body>
        <ns1:type>Guest</ns1:type>
        <ns1:language>
            <ns1:name>powershell</ns1:name>
            <ns1:href>scriptlanguage/5</ns1:href>
            <ns1:id>5</ns1:id>
            <ns1:rel>down</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.ScriptLanguage+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:language>
        <ns1:runAsAdmin>false</ns1:runAsAdmin>
        <ns1:timeout>3600</ns1:timeout>
        <ns1:retries>0</ns1:retries>
        <ns1:delay>0</ns1:delay>
        <ns1:errorAction>Abort</ns1:errorAction>
        <ns1:rebootRequired>false</ns1:rebootRequired>
        <ns1:runOnProvisionOnly>false</ns1:runOnProvisionOnly>
    </ns1:pendingAsset>
    <ns1:pendingAsset xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="ns1:Script">
        <ns1:name>MWS2R2 - AD DSSOE</ns1:name>
        <ns1:id>208</ns1:id>
        <ns1:description></ns1:description>
        <ns1:uuid>db709fb9-ad6f-453b-b6f8-45bffb203da1</ns1:uuid>
        <ns1:assetType>
            <ns1:name>script</ns1:name>
            <ns1:href>assettype/2</ns1:href>
            <ns1:id>2</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.AssetType+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:assetType>
        <ns1:top>false</ns1:top>
        <ns1:assetPath>/Root/MWS2/MWS2_CDCR2</ns1:assetPath>
        <ns1:detailedAssetPath>/Root:#ID#1:#TYPE#VMContainer/MWS2:#ID#8:#TYPE#VMContainer/MWS2_CDCR2:#ID#9:#TYPE#VMProject</ns1:detailedAssetPath>
        <ns1:lifecycleVersion>-1</ns1:lifecycleVersion>
        <ns1:removable>true</ns1:removable>
        <ns1:domain>
            <ns1:name>domain1</ns1:name>
            <ns1:href>domain/1</ns1:href>
            <ns1:id>1</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.Domain+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:domain>
        <ns1:creator>
            <ns1:name>mfreeman</ns1:name>
            <ns1:href>user/12</ns1:href>
            <ns1:id>12</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.User+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:creator>
        <ns1:created>2015-03-09T20:01:19-05:00</ns1:created>
        <ns1:lockType>0</ns1:lockType>
        <ns1:lastModified>2015-03-24T05:22:18-05:00</ns1:lastModified>
        <ns1:parent>
            <ns1:name>MWS2_CDCR2</ns1:name>
            <ns1:href>project/9</ns1:href>
            <ns1:id>9</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.Project+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:parent>
        <ns1:slot>bfbc13cb-2b51-442c-8ae0-80ec7679a074</ns1:slot>
        <ns1:version>-1</ns1:version>
        <ns1:latest>false</ns1:latest>
        <ns1:slotId>176</ns1:slotId>
        <ns1:versionStatus>inprogress</ns1:versionStatus>
        <ns1:checkoutAllowed>false</ns1:checkoutAllowed>
        <ns1:headAllowed>false</ns1:headAllowed>
        <ns1:operatingSystem>Windows</ns1:operatingSystem>
        <ns1:enableExtensions>false</ns1:enableExtensions>
        <ns1:body>write-output &quot;Starting DSSOE Install&quot;
# Load Common functions
. .\\Logging.ps1
. .\\GlobalRepository.ps1
. .\\LaunchProcess.ps1
. .\\FilesUtility.ps1

Start-Sleep -s 120

$scriptPath = split-path -parent $MyInvocation.MyCommand.Definition
$scriptName = $MyInvocation.MyCommand.Name

$domainname = (get-globalvariable &quot;Global\DomainFQDN&quot;).value
$domainNB = (get-globalvariable &quot;Global\DomainNetBIOS&quot;).value
$dn = (get-globalvariable &quot;AD\DistinguishedName&quot;).value

write-output &quot;Installing Agility Deployment Group Policy.&quot;
Write-output &quot;Creating Agility deployment policy&quot;
$gpOut = new-gpo -name AgilityDeploymentPolicy -domain $domainname  | new-gplink -target $dn -Order 1 -Enforced Yes 	-domain $domainname
write-output &quot;$gpOut&quot;
$gpOut = import-gpo -BackupId F2837B33-191B-4677-A964-FA6DA1398A79 -TargetName AgilityDeploymentPolicy -path &quot;$scriptPath\AgilityGPO&quot;
Write-output &quot;$gpOut&quot;
write-output &quot;Agility Deployment Policy created and linked&quot;

#write-output &quot;Installing Active Roles Management.&quot;
#Start-Process &quot;msiexec.exe&quot; -ArgumentList &quot;-i $scriptPath\ActiveRolesManagementShell_x64_1.6.0.msi /q&quot;-Wait
#write-output &quot;Active Roles Management installed.&quot;

write-output &quot;Installing DSSOE.&quot;
cd DSSOE
Start-Process &quot;powershell.exe&quot; -ArgumentList &quot;-executionpolicy bypass $scriptPath\dssoe\dsconfig.ps1&quot;-Wait
write-output &quot;DSSOE Installed.&quot;

#write-output &quot;Disabling DSSOE Domain Controller Policy&quot;
#$dcou = (Get-ADDomain).DomainControllersContainer
#foreach( $gpol in (Get-GPInheritance -Target $dcou).gpolinks){
#    if($gpol.DisplayName -eq 'OU-B-CSCBaselineDomainControllerPolicy'){
#    $gpol.Enabled = $false
#    }
#} 





</ns1:body>
        <ns1:type>Guest</ns1:type>
        <ns1:language>
            <ns1:name>powershell</ns1:name>
            <ns1:href>scriptlanguage/5</ns1:href>
            <ns1:id>5</ns1:id>
            <ns1:rel>down</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.ScriptLanguage+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:language>
        <ns1:runAsAdmin>false</ns1:runAsAdmin>
        <ns1:timeout>3600</ns1:timeout>
        <ns1:retries>0</ns1:retries>
        <ns1:delay>0</ns1:delay>
        <ns1:errorAction>Continue</ns1:errorAction>
        <ns1:rebootRequired>true</ns1:rebootRequired>
        <ns1:runOnProvisionOnly>false</ns1:runOnProvisionOnly>
    </ns1:pendingAsset>
    <ns1:pendingAsset xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="ns1:Script">
        <ns1:name>MWS2R2 - Exchange Copy Install Files</ns1:name>
        <ns1:id>201</ns1:id>
        <ns1:description></ns1:description>
        <ns1:uuid>22170810-c746-4b88-a771-4d0d50731fa8</ns1:uuid>
        <ns1:assetType>
            <ns1:name>script</ns1:name>
            <ns1:href>assettype/2</ns1:href>
            <ns1:id>2</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.AssetType+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:assetType>
        <ns1:top>false</ns1:top>
        <ns1:assetPath>/Root/MWS2/MWS2_CDCR2</ns1:assetPath>
        <ns1:detailedAssetPath>/Root:#ID#1:#TYPE#VMContainer/MWS2:#ID#8:#TYPE#VMContainer/MWS2_CDCR2:#ID#9:#TYPE#VMProject</ns1:detailedAssetPath>
        <ns1:lifecycleVersion>-1</ns1:lifecycleVersion>
        <ns1:removable>true</ns1:removable>
        <ns1:domain>
            <ns1:name>domain1</ns1:name>
            <ns1:href>domain/1</ns1:href>
            <ns1:id>1</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.Domain+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:domain>
        <ns1:creator>
            <ns1:name>rsparkes</ns1:name>
            <ns1:href>user/15</ns1:href>
            <ns1:id>15</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.User+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:creator>
        <ns1:created>2015-02-25T23:26:12-06:00</ns1:created>
        <ns1:lockType>0</ns1:lockType>
        <ns1:lastModified>2015-03-30T21:53:45-05:00</ns1:lastModified>
        <ns1:parent>
            <ns1:name>MWS2_CDCR2</ns1:name>
            <ns1:href>project/9</ns1:href>
            <ns1:id>9</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.Project+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:parent>
        <ns1:version>-1</ns1:version>
        <ns1:latest>false</ns1:latest>
        <ns1:versionStatus>inprogress</ns1:versionStatus>
        <ns1:checkoutAllowed>false</ns1:checkoutAllowed>
        <ns1:headAllowed>false</ns1:headAllowed>
        <ns1:operatingSystem>Windows</ns1:operatingSystem>
        <ns1:enableExtensions>false</ns1:enableExtensions>
        <ns1:body>#	ScriptName: 	Exchange Install Files
#	Author: 	Mark Freeman
#	Required Variables: None
#	Description:
#
#	Downloads exchange installation medi from the deployment share

Write-Host &quot;Starting MWS2-Exchange Install Files&quot;
# Load Common functions
. .\\GlobalRepository.ps1

Write-Host &quot;$((Get-Date).ToString()) : Sleeping for 2 minutes&quot;
Start-Sleep -s 120

Write-Host &quot;$((Get-Date).ToString()) : Copying files.&quot;
Get-AppFiles &quot;Exchange2013SP1&quot;

If ($Error.Count -gt 0) {
	ForEach ($E in $Error) {
		Write-Host &quot;ERROR: $($E.Exception.Message)&quot;
	}
	Write-Host &quot;Completed MWS2-Exchange Install Files&quot;
	Exit -1
} Else {
	Write-Host &quot;Completed MWS2-Exchange Install Files&quot;
	Exit 0
}
</ns1:body>
        <ns1:type>Guest</ns1:type>
        <ns1:language>
            <ns1:name>powershell</ns1:name>
            <ns1:href>scriptlanguage/5</ns1:href>
            <ns1:id>5</ns1:id>
            <ns1:rel>down</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.ScriptLanguage+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:language>
        <ns1:runAsAdmin>false</ns1:runAsAdmin>
        <ns1:timeout>3600</ns1:timeout>
        <ns1:retries>5</ns1:retries>
        <ns1:delay>60</ns1:delay>
        <ns1:errorAction>Abort</ns1:errorAction>
        <ns1:rebootRequired>false</ns1:rebootRequired>
        <ns1:runOnProvisionOnly>false</ns1:runOnProvisionOnly>
    </ns1:pendingAsset>
    <ns1:pendingAsset xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="ns1:Script">
        <ns1:name>MWS2R2 - Exchange Schema Update</ns1:name>
        <ns1:id>198</ns1:id>
        <ns1:description></ns1:description>
        <ns1:uuid>c2fad695-4891-4baf-88e2-2ab25dc1f1ed</ns1:uuid>
        <ns1:assetType>
            <ns1:name>script</ns1:name>
            <ns1:href>assettype/2</ns1:href>
            <ns1:id>2</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.AssetType+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:assetType>
        <ns1:top>false</ns1:top>
        <ns1:assetPath>/Root/MWS2/MWS2_CDCR2</ns1:assetPath>
        <ns1:detailedAssetPath>/Root:#ID#1:#TYPE#VMContainer/MWS2:#ID#8:#TYPE#VMContainer/MWS2_CDCR2:#ID#9:#TYPE#VMProject</ns1:detailedAssetPath>
        <ns1:lifecycleVersion>-1</ns1:lifecycleVersion>
        <ns1:removable>true</ns1:removable>
        <ns1:domain>
            <ns1:name>domain1</ns1:name>
            <ns1:href>domain/1</ns1:href>
            <ns1:id>1</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.Domain+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:domain>
        <ns1:creator>
            <ns1:name>rsparkes</ns1:name>
            <ns1:href>user/15</ns1:href>
            <ns1:id>15</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.User+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:creator>
        <ns1:created>2015-02-25T23:12:08-06:00</ns1:created>
        <ns1:lockType>0</ns1:lockType>
        <ns1:lastModified>2015-03-10T23:55:38-05:00</ns1:lastModified>
        <ns1:parent>
            <ns1:name>MWS2_CDCR2</ns1:name>
            <ns1:href>project/9</ns1:href>
            <ns1:id>9</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.Project+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:parent>
        <ns1:version>-1</ns1:version>
        <ns1:latest>false</ns1:latest>
        <ns1:versionStatus>inprogress</ns1:versionStatus>
        <ns1:checkoutAllowed>false</ns1:checkoutAllowed>
        <ns1:headAllowed>false</ns1:headAllowed>
        <ns1:operatingSystem>Windows</ns1:operatingSystem>
        <ns1:enableExtensions>false</ns1:enableExtensions>
        <ns1:body>#	ScriptName: 	Exchange Schema Update
#	Author: 	Mark Freeman
#	Required Variables: None
#	Description:
#
#	Unattened Exchange schema update, running as exchange service account

write-output &quot;Starting&quot;
# Load Common functions
. .\\LoggingV2.ps1 -newVersion $True
. .\\GlobalRepository.ps1
. .\\LaunchProcess.ps1
. .\\FilesUtility.ps1

#get-appfiles &quot;Exchange2013SP1&quot;

$username = &quot;service.exchange&quot;
$password = (get-globalvariable(&quot;ServiceAccount\\$username&quot;)).value


# Launch process
LaunchProcessAsUser &quot;$scriptPath\\Exchange2013SP1\\setup.exe&quot; &quot;/ps /IAcceptExchangeServerLicenseTerms&quot; $username $password
 
Start-Sleep -Seconds 120
</ns1:body>
        <ns1:type>Guest</ns1:type>
        <ns1:language>
            <ns1:name>powershell</ns1:name>
            <ns1:href>scriptlanguage/5</ns1:href>
            <ns1:id>5</ns1:id>
            <ns1:rel>down</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.ScriptLanguage+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:language>
        <ns1:runAsAdmin>false</ns1:runAsAdmin>
        <ns1:timeout>3600</ns1:timeout>
        <ns1:retries>0</ns1:retries>
        <ns1:delay>0</ns1:delay>
        <ns1:errorAction>Continue</ns1:errorAction>
        <ns1:rebootRequired>false</ns1:rebootRequired>
        <ns1:runOnProvisionOnly>false</ns1:runOnProvisionOnly>
    </ns1:pendingAsset>
    <ns1:pendingAsset xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="ns1:Script">
        <ns1:name>MWS2R2 - Exchange Domain Prep</ns1:name>
        <ns1:id>199</ns1:id>
        <ns1:description></ns1:description>
        <ns1:uuid>dc36a1c4-881f-446b-85d9-e4e33c71e75c</ns1:uuid>
        <ns1:assetType>
            <ns1:name>script</ns1:name>
            <ns1:href>assettype/2</ns1:href>
            <ns1:id>2</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.AssetType+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:assetType>
        <ns1:top>false</ns1:top>
        <ns1:assetPath>/Root/MWS2/MWS2_CDCR2</ns1:assetPath>
        <ns1:detailedAssetPath>/Root:#ID#1:#TYPE#VMContainer/MWS2:#ID#8:#TYPE#VMContainer/MWS2_CDCR2:#ID#9:#TYPE#VMProject</ns1:detailedAssetPath>
        <ns1:lifecycleVersion>-1</ns1:lifecycleVersion>
        <ns1:removable>true</ns1:removable>
        <ns1:domain>
            <ns1:name>domain1</ns1:name>
            <ns1:href>domain/1</ns1:href>
            <ns1:id>1</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.Domain+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:domain>
        <ns1:creator>
            <ns1:name>rsparkes</ns1:name>
            <ns1:href>user/15</ns1:href>
            <ns1:id>15</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.User+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:creator>
        <ns1:created>2015-02-25T23:22:58-06:00</ns1:created>
        <ns1:lockType>0</ns1:lockType>
        <ns1:lastModified>2015-03-10T03:08:37-05:00</ns1:lastModified>
        <ns1:parent>
            <ns1:name>MWS2_CDCR2</ns1:name>
            <ns1:href>project/9</ns1:href>
            <ns1:id>9</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.Project+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:parent>
        <ns1:version>-1</ns1:version>
        <ns1:latest>false</ns1:latest>
        <ns1:versionStatus>inprogress</ns1:versionStatus>
        <ns1:checkoutAllowed>false</ns1:checkoutAllowed>
        <ns1:headAllowed>false</ns1:headAllowed>
        <ns1:operatingSystem>Windows</ns1:operatingSystem>
        <ns1:enableExtensions>false</ns1:enableExtensions>
        <ns1:body>#	ScriptName: 	Exchange Domain Prep
#	Author: 	Mark Freeman
#	Required Variables: None
#	Description:
#
#	Unattended Exchange domain prep - running as exchange service account

write-output &quot;Starting&quot;
# Load Common functions
. .\\LoggingV2.ps1 -newVersion $True
. .\\GlobalRepository.ps1
. .\\LaunchProcess.ps1
. .\\FilesUtility.ps1


$username = &quot;service.exchange&quot;
$password = (get-globalvariable(&quot;ServiceAccount\\$username&quot;)).value
$org = (get-globalvariable(&quot;Global\\DomainNetBIOS&quot;)).value

$Result = LaunchProcessAsUser &quot;$scriptPath\\Exchange2013SP1\\setup.exe&quot; &quot;/p /on:$org /IAcceptExchangeServerLicenseTerms&quot; $username $password

Write-Output &quot;LaunchProcessAsUser completed with return code [$Result]&quot;
Exit $Result
 
</ns1:body>
        <ns1:type>Guest</ns1:type>
        <ns1:language>
            <ns1:name>powershell</ns1:name>
            <ns1:href>scriptlanguage/5</ns1:href>
            <ns1:id>5</ns1:id>
            <ns1:rel>down</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.ScriptLanguage+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:language>
        <ns1:runAsAdmin>false</ns1:runAsAdmin>
        <ns1:timeout>3600</ns1:timeout>
        <ns1:retries>0</ns1:retries>
        <ns1:delay>0</ns1:delay>
        <ns1:errorAction>Continue</ns1:errorAction>
        <ns1:rebootRequired>false</ns1:rebootRequired>
        <ns1:runOnProvisionOnly>false</ns1:runOnProvisionOnly>
    </ns1:pendingAsset>
    <ns1:pendingAsset xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="ns1:Script">
        <ns1:name>MWS2R2 - AD SCCM Schema</ns1:name>
        <ns1:id>226</ns1:id>
        <ns1:description></ns1:description>
        <ns1:uuid>e4b70407-c62a-4418-bdb2-fb1ec6577ee9</ns1:uuid>
        <ns1:assetType>
            <ns1:name>script</ns1:name>
            <ns1:href>assettype/2</ns1:href>
            <ns1:id>2</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.AssetType+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:assetType>
        <ns1:top>false</ns1:top>
        <ns1:assetPath>/Root/MWS2/MWS2_CDCR2</ns1:assetPath>
        <ns1:detailedAssetPath>/Root:#ID#1:#TYPE#VMContainer/MWS2:#ID#8:#TYPE#VMContainer/MWS2_CDCR2:#ID#9:#TYPE#VMProject</ns1:detailedAssetPath>
        <ns1:lifecycleVersion>-1</ns1:lifecycleVersion>
        <ns1:removable>true</ns1:removable>
        <ns1:domain>
            <ns1:name>domain1</ns1:name>
            <ns1:href>domain/1</ns1:href>
            <ns1:id>1</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.Domain+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:domain>
        <ns1:creator>
            <ns1:name>mfreeman</ns1:name>
            <ns1:href>user/12</ns1:href>
            <ns1:id>12</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.User+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:creator>
        <ns1:created>2015-04-06T19:57:05-05:00</ns1:created>
        <ns1:lockType>0</ns1:lockType>
        <ns1:lastModified>2015-04-06T20:26:18-05:00</ns1:lastModified>
        <ns1:parent>
            <ns1:name>MWS2_CDCR2</ns1:name>
            <ns1:href>project/9</ns1:href>
            <ns1:id>9</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.Project+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:parent>
        <ns1:slot>cc7a6cd3-ca1a-40a6-9af3-510aeb0f99e8</ns1:slot>
        <ns1:version>-1</ns1:version>
        <ns1:latest>false</ns1:latest>
        <ns1:slotId>183</ns1:slotId>
        <ns1:versionStatus>inprogress</ns1:versionStatus>
        <ns1:checkoutAllowed>false</ns1:checkoutAllowed>
        <ns1:headAllowed>false</ns1:headAllowed>
        <ns1:operatingSystem>Windows</ns1:operatingSystem>
        <ns1:enableExtensions>false</ns1:enableExtensions>
        <ns1:body>write-output &quot;Starting SCCM Schema&quot;
# Load Common functions
. .\\Logging.ps1
. .\\GlobalRepository.ps1
. .\\LaunchProcess.ps1
. .\\FilesUtility.ps1


$scriptPath = split-path -parent $MyInvocation.MyCommand.Definition
$scriptName = $MyInvocation.MyCommand.Name

$domainname = (get-globalvariable &quot;Global\DomainFQDN&quot;).value
$domainNB = (get-globalvariable &quot;Global\DomainNetBIOS&quot;).value
$dn = (get-globalvariable &quot;AD\DistinguishedName&quot;).value

Start-Sleep -s 120

write-output &quot;Extending Schema&quot;
.\extadsch.exe

write-output &quot;Creating System Management Container&quot;
import-module ActiveDirectory

$cn = New-ADObject -Type Container -name &quot;System Management&quot; -Path &quot;CN=System,$((Get-ADDomain).DistinguishedName)&quot;
$acl = get-acl &quot;ad:CN=System Management,CN=System,$((Get-ADDomain).DistinguishedName)&quot;
$user = get-aduser &quot;svc_sccm_install&quot; 
$sid = [System.Security.Principal.SecurityIdentifier] $user.SID

$ActiveDirectoryRights = &quot;GenericAll&quot;
$AccessControlType = &quot;Allow&quot;
$Inherit = &quot;SelfAndChildren&quot;
$nullGUID = [guid]'00000000-0000-0000-0000-000000000000'
 
$ace = New-Object System.DirectoryServices.ActiveDirectoryAccessRule $sid, $ActiveDirectoryRights, $AccessControlType, $Inherit, $nullGUID
$acl.AddAccessRule($ace) 
Set-acl -aclobject $acl &quot;ad:CN=System Management,CN=System,$((Get-ADDomain).DistinguishedName)&quot;

write-output &quot;Completed SCCM Schema&quot;



</ns1:body>
        <ns1:type>Guest</ns1:type>
        <ns1:language>
            <ns1:name>powershell</ns1:name>
            <ns1:href>scriptlanguage/5</ns1:href>
            <ns1:id>5</ns1:id>
            <ns1:rel>down</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.ScriptLanguage+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:language>
        <ns1:runAsAdmin>false</ns1:runAsAdmin>
        <ns1:timeout>3600</ns1:timeout>
        <ns1:retries>0</ns1:retries>
        <ns1:delay>0</ns1:delay>
        <ns1:errorAction>Continue</ns1:errorAction>
        <ns1:rebootRequired>false</ns1:rebootRequired>
        <ns1:runOnProvisionOnly>false</ns1:runOnProvisionOnly>
    </ns1:pendingAsset>
    <ns1:pendingAsset xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="ns1:Script">
        <ns1:name>MWS2R2 - AD MWS Policies</ns1:name>
        <ns1:id>221</ns1:id>
        <ns1:description></ns1:description>
        <ns1:uuid>4c88c0cc-0f9a-40c2-9b57-ee7616c7f516</ns1:uuid>
        <ns1:assetType>
            <ns1:name>script</ns1:name>
            <ns1:href>assettype/2</ns1:href>
            <ns1:id>2</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.AssetType+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:assetType>
        <ns1:top>false</ns1:top>
        <ns1:assetPath>/Root/MWS2/MWS2_CDCR2</ns1:assetPath>
        <ns1:detailedAssetPath>/Root:#ID#1:#TYPE#VMContainer/MWS2:#ID#8:#TYPE#VMContainer/MWS2_CDCR2:#ID#9:#TYPE#VMProject</ns1:detailedAssetPath>
        <ns1:lifecycleVersion>-1</ns1:lifecycleVersion>
        <ns1:removable>true</ns1:removable>
        <ns1:domain>
            <ns1:name>domain1</ns1:name>
            <ns1:href>domain/1</ns1:href>
            <ns1:id>1</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.Domain+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:domain>
        <ns1:creator>
            <ns1:name>mfreeman</ns1:name>
            <ns1:href>user/12</ns1:href>
            <ns1:id>12</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.User+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:creator>
        <ns1:created>2015-03-19T17:41:29-05:00</ns1:created>
        <ns1:lockType>0</ns1:lockType>
        <ns1:lastModified>2015-03-26T20:33:31-05:00</ns1:lastModified>
        <ns1:parent>
            <ns1:name>MWS2_CDCR2</ns1:name>
            <ns1:href>project/9</ns1:href>
            <ns1:id>9</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.Project+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:parent>
        <ns1:slot>f0a95aa5-4e24-4280-9343-98dd7821a342</ns1:slot>
        <ns1:version>-1</ns1:version>
        <ns1:latest>false</ns1:latest>
        <ns1:slotId>181</ns1:slotId>
        <ns1:versionStatus>inprogress</ns1:versionStatus>
        <ns1:checkoutAllowed>false</ns1:checkoutAllowed>
        <ns1:headAllowed>false</ns1:headAllowed>
        <ns1:operatingSystem>Windows</ns1:operatingSystem>
        <ns1:enableExtensions>false</ns1:enableExtensions>
        <ns1:body>write-output &quot;Starting MWS Policies&quot;
# Load Common functions
. .\\Logging.ps1
. .\\GlobalRepository.ps1
. .\\LaunchProcess.ps1
. .\\FilesUtility.ps1

Start-Sleep -s 120

$scriptPath = split-path -parent $MyInvocation.MyCommand.Definition
$scriptName = $MyInvocation.MyCommand.Name

$domainname = (get-globalvariable &quot;Global\DomainFQDN&quot;).value
$domainNB = (get-globalvariable &quot;Global\DomainNetBIOS&quot;).value
$dn = (get-globalvariable &quot;AD\DistinguishedName&quot;).value

write-output &quot;Creating folders&quot;
MD e:\Admin
MD e:\Scripts

write-output &quot;Creating reserve file&quot;
fsutil file createnew e:\reservefile 512000000

write-output &quot;Restricting RPC Port Ranges&quot;
MD HKLM:\Software\Microsoft\Rpc\Internet
New-ItemProperty -Path HKLM:\Software\Microsoft\Rpc\Internet -Name Ports -PropertyType MultiString  -Value &quot;49152-49407&quot;
New-ItemProperty -Path HKLM:\Software\Microsoft\Rpc\Internet -Name PortsInternetAvailable -PropertyType String  -Value &quot;Y&quot;
New-ItemProperty -Path HKLM:\Software\Microsoft\Rpc\Internet -Name UseInternetPorts -PropertyType String  -Value &quot;Y&quot;


write-output &quot;Installing MWS Audit Settings.&quot;
. .\MWS-ImportAuditSettings.ps1

write-output &quot;Installing MWS Domain Group Policy.&quot;
$gpOut = new-gpo -name MWSDomainPolicy -domain $domainname  | new-gplink -target $dn -Order 1 -domain $domainname
$gpOut = import-gpo -BackupId 49b08726-736b-471c-af44-a7882cc552d9 -TargetName MWSDomainPolicy -path &quot;$scriptPath\MWSGPO&quot;
write-output &quot;MWS Domain Group Policy created and linked&quot;

write-output &quot;Installing MWS Domain Controller Group Policy.&quot;
$gpOut = new-gpo -name MWSDomainControllerPolicy -domain $domainname  | new-gplink -target &quot;ou=Domain Controllers,$dn&quot; -Order 1 -domain $domainname
$gpOut = import-gpo -BackupId BD6FFD6A-2094-4E7F-9FB8-382C1D978952 -TargetName MWSDomainControllerPolicy -path &quot;$scriptPath\MWSGPO&quot;
write-output &quot;MWS Domain Controller Group Policy created and linked&quot;

write-output &quot;Installing MWS Member Server Group Policy.&quot;
$gpOut = new-gpo -name MWSMemberServerPolicy -domain $domainname  | new-gplink -target &quot;ou=Servers,ou=Customer,$dn&quot; -Order 1 -domain $domainname
$gpOut = import-gpo -BackupId f4b545e5-4a1a-4248-bb5d-b9b9aeb6ae79 -TargetName MWSMemberServerPolicy -path &quot;$scriptPath\MWSGPO&quot;
write-output &quot;MWS Member Server Group Policy created and linked&quot;

write-output &quot;Adding Exchange servers group to PERM-D-DCSecurityLogManager&quot;
Add-ADGroupMember 'PERM-D-DCSecurityLogManager' 'Exchange Servers'

write-output &quot;Enabling Recycle Bin&quot;
Enable-ADOptionalFeature 'Recycle Bin Feature' -Scope ForestOrConfigurationSet -Target $domainname -confirm:$false

write-output &quot;Setting Domain Password Object&quot;
New-ADFineGrainedPasswordPolicy -Name &quot;DomainUsersPSO&quot; -Precedence 10 -Description &quot;Domain Users Password Policy&quot; -DisplayName &quot;Domain Users PSO&quot; -MinPasswordLength 15 -LockoutDuration &quot;0.00:04:00&quot; -LockoutObservationWindow &quot;0.00:04:00&quot; -LockoutThreshold 4 -PasswordHistoryCount 6 -ReversibleEncryptionEnabled $false -ComplexityEnabled $true -MinPasswordAge &quot;1.00:00:00&quot; -MaxPasswordAge &quot;60.00:00:00&quot;
Add-ADFineGrainedPasswordPolicySubject DomainUsersPSO -Subjects 'Domain Users'


write-output &quot;MWS Policies Installed.&quot;</ns1:body>
        <ns1:type>Guest</ns1:type>
        <ns1:language>
            <ns1:name>powershell</ns1:name>
            <ns1:href>scriptlanguage/5</ns1:href>
            <ns1:id>5</ns1:id>
            <ns1:rel>down</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.ScriptLanguage+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:language>
        <ns1:runAsAdmin>false</ns1:runAsAdmin>
        <ns1:timeout>3600</ns1:timeout>
        <ns1:retries>0</ns1:retries>
        <ns1:delay>0</ns1:delay>
        <ns1:errorAction>Continue</ns1:errorAction>
        <ns1:rebootRequired>true</ns1:rebootRequired>
        <ns1:runOnProvisionOnly>false</ns1:runOnProvisionOnly>
    </ns1:pendingAsset>
    <ns1:pendingAsset xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="ns1:Script">
        <ns1:name>MWS2R2 - AD Assign Replicate Dir Changes</ns1:name>
        <ns1:id>246</ns1:id>
        <ns1:description>Assignes Replicate Directory Changes to a given account. This is required by SharePoint 2013 to support user Profiles synchronisation.</ns1:description>
        <ns1:uuid>71e32c24-532b-4171-9f3e-045c414757e4</ns1:uuid>
        <ns1:assetType>
            <ns1:name>script</ns1:name>
            <ns1:href>assettype/2</ns1:href>
            <ns1:id>2</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.AssetType+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:assetType>
        <ns1:top>false</ns1:top>
        <ns1:assetPath>/Root/MWS2/MWS2_CDCR2</ns1:assetPath>
        <ns1:detailedAssetPath>/Root:#ID#1:#TYPE#VMContainer/MWS2:#ID#8:#TYPE#VMContainer/MWS2_CDCR2:#ID#9:#TYPE#VMProject</ns1:detailedAssetPath>
        <ns1:lifecycleVersion>-1</ns1:lifecycleVersion>
        <ns1:removable>true</ns1:removable>
        <ns1:domain>
            <ns1:name>domain1</ns1:name>
            <ns1:href>domain/1</ns1:href>
            <ns1:id>1</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.Domain+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:domain>
        <ns1:creator>
            <ns1:name>mkrynina</ns1:name>
            <ns1:href>user/6</ns1:href>
            <ns1:id>6</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.User+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:creator>
        <ns1:created>2015-04-28T22:25:07-05:00</ns1:created>
        <ns1:lockType>0</ns1:lockType>
        <ns1:lastModified>2015-04-29T00:12:21-05:00</ns1:lastModified>
        <ns1:parent>
            <ns1:name>MWS2_CDCR2</ns1:name>
            <ns1:href>project/9</ns1:href>
            <ns1:id>9</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.Project+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:parent>
        <ns1:version>-1</ns1:version>
        <ns1:latest>false</ns1:latest>
        <ns1:versionStatus>inprogress</ns1:versionStatus>
        <ns1:checkoutAllowed>false</ns1:checkoutAllowed>
        <ns1:headAllowed>false</ns1:headAllowed>
        <ns1:operatingSystem>Windows</ns1:operatingSystem>
        <ns1:enableExtensions>false</ns1:enableExtensions>
        <ns1:body># MWS2R2 -Assign Replicate Dir Changes ##################################################################
# Author: Marina Krynina
#################################################################################################
try
{
	write-host &quot;INFO: Attempting to assign Replicate Directory Changes permission to $SVC_IDENTITY&quot;
	$scriptPath = $env:USERPROFILE

    . .\Assign-ReplicateDirChanges.ps1 -scriptPath $scriptPath -identity $SVC_IDENTITY

	exit 0
}
catch
{
	write-host &quot;ERROR: $($_.Exception.Message)&quot;
	exit 1
}</ns1:body>
        <ns1:type>Guest</ns1:type>
        <ns1:language>
            <ns1:name>powershell</ns1:name>
            <ns1:href>scriptlanguage/5</ns1:href>
            <ns1:id>5</ns1:id>
            <ns1:rel>down</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.ScriptLanguage+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:language>
        <ns1:runAsAdmin>false</ns1:runAsAdmin>
        <ns1:timeout>3600</ns1:timeout>
        <ns1:retries>0</ns1:retries>
        <ns1:delay>0</ns1:delay>
        <ns1:errorAction>Continue</ns1:errorAction>
        <ns1:rebootRequired>false</ns1:rebootRequired>
        <ns1:variable>
            <ns1:name>SVC_IDENTITY</ns1:name>
            <ns1:id>428</ns1:id>
            <ns1:description></ns1:description>
            <ns1:uuid>b8e21615-a00d-4f7e-b8f6-07cf8944db46</ns1:uuid>
            <ns1:top>false</ns1:top>
            <ns1:assetPath></ns1:assetPath>
            <ns1:detailedAssetPath></ns1:detailedAssetPath>
            <ns1:lifecycleVersion>-1</ns1:lifecycleVersion>
            <ns1:removable>true</ns1:removable>
            <ns1:displayName>SVC_IDENTITY</ns1:displayName>
            <ns1:readable>true</ns1:readable>
            <ns1:writable>true</ns1:writable>
            <ns1:minRequired>0</ns1:minRequired>
            <ns1:maxAllowed>1</ns1:maxAllowed>
            <ns1:validator/>
            <ns1:defaultValue>
                <ns1:id>14352</ns1:id>
                <ns1:name></ns1:name>
                <ns1:encrypted>false</ns1:encrypted>
                <ns1:overridable>true</ns1:overridable>
                <ns1:propertyType>
                    <ns1:name>string-any</ns1:name>
                    <ns1:href>/propertytype/4</ns1:href>
                    <ns1:id>4</ns1:id>
                    <ns1:rel>up</ns1:rel>
                    <ns1:type>application/com.servicemesh.agility.api.PropertyType+xml</ns1:type>
                    <ns1:position>0</ns1:position>
                </ns1:propertyType>
                <ns1:stringValue>svc_sp_UserProfile</ns1:stringValue>
            </ns1:defaultValue>
            <ns1:propertyType>
                <ns1:name>string-any</ns1:name>
                <ns1:href>propertytype/4</ns1:href>
                <ns1:id>4</ns1:id>
                <ns1:type>application/com.servicemesh.agility.api.PropertyType+xml</ns1:type>
            </ns1:propertyType>
            <ns1:assetPropertyLinkId>eb6f0e20-5f06-4ad0-af1b-1b5acf0b16c2</ns1:assetPropertyLinkId>
        </ns1:variable>
        <ns1:runOnProvisionOnly>false</ns1:runOnProvisionOnly>
    </ns1:pendingAsset>
    <ns1:Asset xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="ns1:Package">
        <ns1:name>MWS2R2 - AD Create Active Directory</ns1:name>
        <ns1:id>31</ns1:id>
        <ns1:description></ns1:description>
        <ns1:uuid>1589df9a-2d35-4800-939b-2e98fe144fed</ns1:uuid>
        <ns1:assetType>
            <ns1:name>package</ns1:name>
            <ns1:href>assettype/3</ns1:href>
            <ns1:id>3</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.AssetType+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:assetType>
        <ns1:top>true</ns1:top>
        <ns1:assetPath>/Root/MWS2/MWS2_CDCR2</ns1:assetPath>
        <ns1:detailedAssetPath>/Root:#ID#1:#TYPE#VMContainer/MWS2:#ID#8:#TYPE#VMContainer/MWS2_CDCR2:#ID#9:#TYPE#VMProject</ns1:detailedAssetPath>
        <ns1:lifecycleVersion>-1</ns1:lifecycleVersion>
        <ns1:removable>true</ns1:removable>
        <ns1:domain>
            <ns1:name>domain1</ns1:name>
            <ns1:href>domain/1</ns1:href>
            <ns1:id>1</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.Domain+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:domain>
        <ns1:creator>
            <ns1:name>dhatchett-admin</ns1:name>
            <ns1:href>user/14</ns1:href>
            <ns1:id>14</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.User+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:creator>
        <ns1:created>2015-02-10T00:44:40-06:00</ns1:created>
        <ns1:lockType>0</ns1:lockType>
        <ns1:lastModified>2015-04-28T23:09:26-05:00</ns1:lastModified>
        <ns1:parent>
            <ns1:name>MWS2_CDCR2</ns1:name>
            <ns1:href>project/9</ns1:href>
            <ns1:id>9</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.Project+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:parent>
        <ns1:version>-1</ns1:version>
        <ns1:latest>false</ns1:latest>
        <ns1:versionStatus>inprogress</ns1:versionStatus>
        <ns1:checkoutAllowed>false</ns1:checkoutAllowed>
        <ns1:headAllowed>false</ns1:headAllowed>
        <ns1:operatingSystem>Windows</ns1:operatingSystem>
        <ns1:install>
            <ns1:name>MWS2R2 - AD Global Repository</ns1:name>
            <ns1:href>script/132</ns1:href>
            <ns1:id>132</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.Script+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:install>
        <ns1:install>
            <ns1:name>MWS2R2 - AD Rename Computer</ns1:name>
            <ns1:href>script/134</ns1:href>
            <ns1:id>134</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.Script+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:install>
        <ns1:install>
            <ns1:name>MWS2R2 - AD Create Active Directory</ns1:name>
            <ns1:href>script/131</ns1:href>
            <ns1:id>131</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.Script+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:install>
        <ns1:install>
            <ns1:name>MWS2R2 - AD Configure Active Directory</ns1:name>
            <ns1:href>script/130</ns1:href>
            <ns1:id>130</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.Script+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:install>
        <ns1:install>
            <ns1:name>MWS2R2 - AD DSSOE</ns1:name>
            <ns1:href>script/208</ns1:href>
            <ns1:id>208</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.Script+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:install>
        <ns1:install>
            <ns1:name>MWS2R2 - Exchange Copy Install Files</ns1:name>
            <ns1:href>script/201</ns1:href>
            <ns1:id>201</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.Script+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:install>
        <ns1:install>
            <ns1:name>MWS2R2 - Exchange Schema Update</ns1:name>
            <ns1:href>script/198</ns1:href>
            <ns1:id>198</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.Script+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:install>
        <ns1:install>
            <ns1:name>MWS2R2 - Exchange Domain Prep</ns1:name>
            <ns1:href>script/199</ns1:href>
            <ns1:id>199</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.Script+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:install>
        <ns1:install>
            <ns1:name>MWS2R2 - AD SCCM Schema</ns1:name>
            <ns1:href>script/226</ns1:href>
            <ns1:id>226</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.Script+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:install>
        <ns1:install>
            <ns1:name>MWS2R2 - AD MWS Policies</ns1:name>
            <ns1:href>script/221</ns1:href>
            <ns1:id>221</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.Script+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:install>
        <ns1:install>
            <ns1:name>MWS2R2 - AD Assign Replicate Dir Changes</ns1:name>
            <ns1:href>script/246</ns1:href>
            <ns1:id>246</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.Script+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:install>
        <ns1:operational>
            <ns1:name>MWS2R2 - AD SCCM Schema</ns1:name>
            <ns1:href>script/226</ns1:href>
            <ns1:id>226</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.Script+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:operational>
        <ns1:operational>
            <ns1:name>MWS2R2 - AD Assign Replicate Dir Changes</ns1:name>
            <ns1:href>script/246</ns1:href>
            <ns1:id>246</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.Script+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:operational>
    </ns1:Asset>
</ns1:Envelope>
