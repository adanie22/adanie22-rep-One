<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<ns1:Envelope xmlns:ns1="http://servicemesh.com/agility/api" xmlns:ns2="http://servicemesh.com/core/messaging" ns1:version="3.0" ns1:productVersion="9.2.4">
    <ns1:pendingAsset xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="ns1:Script">
        <ns1:name>MWS2R2 - Get App Files</ns1:name>
        <ns1:id>244</ns1:id>
        <ns1:description>Copies application files from the nominated network share to the target VM.</ns1:description>
        <ns1:uuid>e1b3ea17-f27b-44c4-bd71-8c5b5e4ef782</ns1:uuid>
        <ns1:assetType>
            <ns1:name>script</ns1:name>
            <ns1:href>assettype/2</ns1:href>
            <ns1:id>2</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.AssetType+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:assetType>
        <ns1:top>false</ns1:top>
        <ns1:assetPath>/Root/MWS2/MWS2_CDCR2</ns1:assetPath>
        <ns1:detailedAssetPath>/Root:#ID#1:#TYPE#VMContainer/MWS2:#ID#8:#TYPE#VMContainer/MWS2_CDCR2:#ID#9:#TYPE#VMProject</ns1:detailedAssetPath>
        <ns1:lifecycleVersion>-1</ns1:lifecycleVersion>
        <ns1:removable>true</ns1:removable>
        <ns1:domain>
            <ns1:name>domain1</ns1:name>
            <ns1:href>domain/1</ns1:href>
            <ns1:id>1</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.Domain+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:domain>
        <ns1:creator>
            <ns1:name>skoklevski</ns1:name>
            <ns1:href>user/11</ns1:href>
            <ns1:id>11</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.User+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:creator>
        <ns1:created>2015-04-28T00:51:06-05:00</ns1:created>
        <ns1:lockType>0</ns1:lockType>
        <ns1:lastModified>2015-04-28T00:58:09-05:00</ns1:lastModified>
        <ns1:parent>
            <ns1:name>MWS2_CDCR2</ns1:name>
            <ns1:href>project/9</ns1:href>
            <ns1:id>9</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.Project+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:parent>
        <ns1:slot>9e7fcc13-4d05-4591-a6bf-4640b548e17f</ns1:slot>
        <ns1:version>5</ns1:version>
        <ns1:latest>false</ns1:latest>
        <ns1:publishComment>updated to use LoggingV2</ns1:publishComment>
        <ns1:slotId>146</ns1:slotId>
        <ns1:publisher>
            <ns1:name>skoklevski</ns1:name>
            <ns1:href>user/11</ns1:href>
            <ns1:id>11</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.User+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:publisher>
        <ns1:versionStatus>active</ns1:versionStatus>
        <ns1:checkoutAllowed>false</ns1:checkoutAllowed>
        <ns1:headAllowed>false</ns1:headAllowed>
        <ns1:operatingSystem>Windows</ns1:operatingSystem>
        <ns1:enableExtensions>false</ns1:enableExtensions>
        <ns1:body># MWS2 - Get App Files ##############################################################
# Author: Marina Krynina
# Desc:   Deploys installation files onto the target server
############################################################################################

# Mandatory heading
# Load Common functions
. .\GlobalRepository.ps1
. .\VariableUtility.ps1
. .\FilesUtility.ps1
. .\LaunchProcess.ps1

#########################################################################
# Main 
# - Deploys installation files onto the target server
#########################################################################
try
{
    $scriptPath = $env:USERPROFILE
    . .\LoggingV2.ps1 $true $scriptPath &quot;GetAppFiles.ps1&quot;

    log &quot;INFO: Getting variables values or setting defaults if the variables are not populated.&quot;
    $sourceFolders = (Get-VariableValue $SOURCE &quot;&quot; $false) 

    foreach($srcFolder in ($sourceFolders.Replace(&quot; &quot;, &quot;&quot;)).Split(&quot;,&quot;))
    {
        log &quot;INFO: Deploying $srcFolder folder onto the target VM&quot;
        get-appfiles $srcFolder    
    }

    log &quot;INFO: Finished $msg.&quot;

    exit 0
}
catch
{
    $ex = $_.Exception | format-list | Out-String
    log &quot;ERROR: Exception occurred `nException Message: $ex&quot;

    exit 1
}
</ns1:body>
        <ns1:type>Guest</ns1:type>
        <ns1:language>
            <ns1:name>powershell</ns1:name>
            <ns1:href>scriptlanguage/5</ns1:href>
            <ns1:id>5</ns1:id>
            <ns1:rel>down</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.ScriptLanguage+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:language>
        <ns1:runAsAdmin>false</ns1:runAsAdmin>
        <ns1:timeout>3600</ns1:timeout>
        <ns1:retries>0</ns1:retries>
        <ns1:delay>0</ns1:delay>
        <ns1:errorAction>Continue</ns1:errorAction>
        <ns1:rebootRequired>false</ns1:rebootRequired>
        <ns1:variable>
            <ns1:name>SOURCE</ns1:name>
            <ns1:id>425</ns1:id>
            <ns1:description>Folder on a network share where install files and supporting scripts are stored. The content of the folder will be copied onto a target server.</ns1:description>
            <ns1:uuid>d640684d-9a85-43f9-9644-f913757eacee</ns1:uuid>
            <ns1:top>false</ns1:top>
            <ns1:assetPath></ns1:assetPath>
            <ns1:detailedAssetPath></ns1:detailedAssetPath>
            <ns1:lifecycleVersion>-1</ns1:lifecycleVersion>
            <ns1:removable>true</ns1:removable>
            <ns1:displayName>SOURCE</ns1:displayName>
            <ns1:readable>true</ns1:readable>
            <ns1:writable>true</ns1:writable>
            <ns1:minRequired>0</ns1:minRequired>
            <ns1:maxAllowed>1</ns1:maxAllowed>
            <ns1:validator/>
            <ns1:propertyType>
                <ns1:name>string-any</ns1:name>
                <ns1:href>propertytype/4</ns1:href>
                <ns1:id>4</ns1:id>
                <ns1:type>application/com.servicemesh.agility.api.PropertyType+xml</ns1:type>
            </ns1:propertyType>
            <ns1:assetPropertyLinkId>1db54451-3f1d-4aee-b3e7-48b9fba6a375</ns1:assetPropertyLinkId>
        </ns1:variable>
        <ns1:runOnProvisionOnly>false</ns1:runOnProvisionOnly>
    </ns1:pendingAsset>
    <ns1:pendingAsset xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="ns1:Script">
        <ns1:name>MWS2R2 - Extract App Files</ns1:name>
        <ns1:id>245</ns1:id>
        <ns1:description>Extracts ISO, ZIP application files using 7zip in the given folder including subfolders</ns1:description>
        <ns1:uuid>9b1babf8-be8f-436e-8ae8-b6e0ec66233a</ns1:uuid>
        <ns1:assetType>
            <ns1:name>script</ns1:name>
            <ns1:href>assettype/2</ns1:href>
            <ns1:id>2</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.AssetType+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:assetType>
        <ns1:top>false</ns1:top>
        <ns1:assetPath>/Root/MWS2/MWS2_CDCR2</ns1:assetPath>
        <ns1:detailedAssetPath>/Root:#ID#1:#TYPE#VMContainer/MWS2:#ID#8:#TYPE#VMContainer/MWS2_CDCR2:#ID#9:#TYPE#VMProject</ns1:detailedAssetPath>
        <ns1:lifecycleVersion>-1</ns1:lifecycleVersion>
        <ns1:removable>true</ns1:removable>
        <ns1:domain>
            <ns1:name>domain1</ns1:name>
            <ns1:href>domain/1</ns1:href>
            <ns1:id>1</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.Domain+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:domain>
        <ns1:creator>
            <ns1:name>skoklevski</ns1:name>
            <ns1:href>user/11</ns1:href>
            <ns1:id>11</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.User+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:creator>
        <ns1:created>2015-04-28T00:58:27-05:00</ns1:created>
        <ns1:lockType>0</ns1:lockType>
        <ns1:lastModified>2015-04-28T01:00:03-05:00</ns1:lastModified>
        <ns1:parent>
            <ns1:name>MWS2_CDCR2</ns1:name>
            <ns1:href>project/9</ns1:href>
            <ns1:id>9</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.Project+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:parent>
        <ns1:slot>5dba46a3-47e8-4044-a6d6-db71eb781028</ns1:slot>
        <ns1:version>5</ns1:version>
        <ns1:latest>false</ns1:latest>
        <ns1:publishComment>updated to use LoggingV2</ns1:publishComment>
        <ns1:slotId>147</ns1:slotId>
        <ns1:publisher>
            <ns1:name>skoklevski</ns1:name>
            <ns1:href>user/11</ns1:href>
            <ns1:id>11</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.User+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:publisher>
        <ns1:versionStatus>active</ns1:versionStatus>
        <ns1:checkoutAllowed>false</ns1:checkoutAllowed>
        <ns1:headAllowed>false</ns1:headAllowed>
        <ns1:operatingSystem>Windows</ns1:operatingSystem>
        <ns1:enableExtensions>false</ns1:enableExtensions>
        <ns1:body># MWS2R2 - Extract App Files ###############################################################
# Author: Marina Krynina
# Desc:   Extracts application files (ISO, ZIP)
############################################################################################

# Mandatory heading
# Load Common functions
. .\GlobalRepository.ps1
. .\VariableUtility.ps1
. .\FilesUtility.ps1
. .\LaunchProcess.ps1

#########################################################################
# Main 
#########################################################################
try
{
    # Folder structure in the Global Repository
    # \Global Repository
    #	\$SOURCE,  folder name in the Global Repository

    # Folder structure on VM
    # C:\Users\InstallerAccount
    #		\$INSTALL_MEDIA - the content of the isntall media will be extracted here

    $scriptPath = $env:USERPROFILE
    . .\LoggingV2.ps1 $true $scriptPath &quot;ExtractAppFiles.ps1&quot;

    log &quot;INFO: Getting variables values or setting defaults if the variables are not populated.&quot;
    $installMedia = (Get-VariableValue $INSTALL_MEDIA &quot;&quot; $false) 

    # Extracting
    $msg = &quot;Extracting application installation files&quot;
    log &quot;INFO: Starting $msg&quot;
    
    # 7za920.exe does not support ISO files, 7z.exe does.
    # 7z files are located in the Common folder and copied by default
    $extractionTool = &quot;$scriptPath\7z.exe&quot;

	foreach($srcFolder in ($installMedia.Replace(&quot; &quot;, &quot;&quot;)).Split(&quot;,&quot;))
    {
 
      if (([string]::IsNullOrEmpty($installMedia)) -eq $true)
      {
          $installMediaSource = &quot;$scriptPath&quot;
      }
      else
      {
          $installMediaSource = &quot;$scriptPath\$srcFolder&quot;
      }
      
      Extract $extractionTool $installMediaSource
	}

	log &quot;INFO: Finished $msg.&quot;

    exit 0
}
catch
{
    $ex = $_.Exception | format-list | Out-String
    log &quot;ERROR: Exception occurred `nException Message: $ex&quot;

    exit 1
}
</ns1:body>
        <ns1:type>Guest</ns1:type>
        <ns1:language>
            <ns1:name>powershell</ns1:name>
            <ns1:href>scriptlanguage/5</ns1:href>
            <ns1:id>5</ns1:id>
            <ns1:rel>down</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.ScriptLanguage+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:language>
        <ns1:runAsAdmin>false</ns1:runAsAdmin>
        <ns1:timeout>3600</ns1:timeout>
        <ns1:retries>0</ns1:retries>
        <ns1:delay>0</ns1:delay>
        <ns1:errorAction>Continue</ns1:errorAction>
        <ns1:rebootRequired>false</ns1:rebootRequired>
        <ns1:variable>
            <ns1:name>INSTALL_MEDIA</ns1:name>
            <ns1:id>426</ns1:id>
            <ns1:description>Folder name where installation media is located.</ns1:description>
            <ns1:uuid>47d2e14d-8a2c-4888-a8c5-ed5ab2c2a421</ns1:uuid>
            <ns1:top>false</ns1:top>
            <ns1:assetPath></ns1:assetPath>
            <ns1:detailedAssetPath></ns1:detailedAssetPath>
            <ns1:lifecycleVersion>-1</ns1:lifecycleVersion>
            <ns1:removable>true</ns1:removable>
            <ns1:displayName>INSTALL_MEDIA</ns1:displayName>
            <ns1:readable>true</ns1:readable>
            <ns1:writable>true</ns1:writable>
            <ns1:minRequired>0</ns1:minRequired>
            <ns1:maxAllowed>1</ns1:maxAllowed>
            <ns1:validator/>
            <ns1:propertyType>
                <ns1:name>string-any</ns1:name>
                <ns1:href>propertytype/4</ns1:href>
                <ns1:id>4</ns1:id>
                <ns1:type>application/com.servicemesh.agility.api.PropertyType+xml</ns1:type>
            </ns1:propertyType>
            <ns1:assetPropertyLinkId>bc307644-db80-42ec-a3c4-91d263a50d59</ns1:assetPropertyLinkId>
        </ns1:variable>
        <ns1:runOnProvisionOnly>false</ns1:runOnProvisionOnly>
    </ns1:pendingAsset>
    <ns1:pendingAsset xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="ns1:Script">
        <ns1:name>MWS2R2 - SharePoint SQL2012SP1Std install</ns1:name>
        <ns1:id>152</ns1:id>
        <ns1:description></ns1:description>
        <ns1:uuid>9e6b859e-d6b1-416e-aa30-dfe281ff6337</ns1:uuid>
        <ns1:assetType>
            <ns1:name>script</ns1:name>
            <ns1:href>assettype/2</ns1:href>
            <ns1:id>2</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.AssetType+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:assetType>
        <ns1:top>false</ns1:top>
        <ns1:assetPath>/Root/MWS2/MWS2_CDCR2</ns1:assetPath>
        <ns1:detailedAssetPath>/Root:#ID#1:#TYPE#VMContainer/MWS2:#ID#8:#TYPE#VMContainer/MWS2_CDCR2:#ID#9:#TYPE#VMProject</ns1:detailedAssetPath>
        <ns1:lifecycleVersion>-1</ns1:lifecycleVersion>
        <ns1:removable>true</ns1:removable>
        <ns1:domain>
            <ns1:name>domain1</ns1:name>
            <ns1:href>domain/1</ns1:href>
            <ns1:id>1</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.Domain+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:domain>
        <ns1:creator>
            <ns1:name>mkrynina</ns1:name>
            <ns1:href>user/6</ns1:href>
            <ns1:id>6</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.User+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:creator>
        <ns1:created>2015-02-17T04:55:42-06:00</ns1:created>
        <ns1:lockType>0</ns1:lockType>
        <ns1:lastModified>2015-02-18T19:12:52-06:00</ns1:lastModified>
        <ns1:parent>
            <ns1:name>MWS2_CDCR2</ns1:name>
            <ns1:href>project/9</ns1:href>
            <ns1:id>9</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.Project+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:parent>
        <ns1:version>-1</ns1:version>
        <ns1:latest>false</ns1:latest>
        <ns1:versionStatus>inprogress</ns1:versionStatus>
        <ns1:checkoutAllowed>false</ns1:checkoutAllowed>
        <ns1:headAllowed>false</ns1:headAllowed>
        <ns1:operatingSystem>Windows</ns1:operatingSystem>
        <ns1:enableExtensions>false</ns1:enableExtensions>
        <ns1:body># Mandatory heading
# Load Common functions
. .\Logging.ps1
. .\LaunchProcess.ps1
. .\FilesUtility.ps1
. .\Get-SQLInstance.ps1
. .\Get-IniContent.ps1
. .\GlobalRepository.ps1
. .\VariableUtility.ps1
. .\Install-SQL2012.ps1

# get current script location
$scriptPath = split-path -parent $MyInvocation.MyCommand.Definition
$scriptName = $MyInvocation.MyCommand.Name
ConfigureLogging $scriptPath $scriptName

#########################################################################
# Main 
# - Deploys installation files onto the target server
# - Extracts installation files
# - Installs SQL 2012 SP1 Std
#########################################################################
try
{
    $useHardcodedDefaults = $false
    # Get admin creadentials
    if ($useHardcodedDefaults)
    {
        $domain = (Get-VariableValue $DOMAIN &quot;dev&quot; $useHardcodedDefaults)   
        $user = (Get-VariableValue $USER &quot;administrator&quot; $useHardcodedDefaults)
        $password = (Get-VariableValue $PASSWORD &quot;p@ssw0rd&quot; $useHardcodedDefaults)

        $configFile = $scriptPath + &quot;\&quot; + (Get-VariableValue $CONFIG_XML &quot;3_SQL2012Std_SharePoint.xml&quot; $useHardcodedDefaults)

        $svc_sql = (Get-VariableValue $SVC_SQL &quot;svc_sql&quot; $useHardcodedDefaults)
        $svc_sql_pwd = (Get-VariableValue $SVC_SQL_PWD &quot;p@ssw0rd&quot; $useHardcodedDefaults)
    }
    else
    {
        $user = (Get-VariableValue $USER &quot;agilitydeploy&quot; $true)
        $password = (get-globalvariable(&quot;ServiceAccount\$user&quot;)).value
        $domain = (get-globalvariable(&quot;Global\DomainNetBIOS&quot;)).value

        $svc_sql = (Get-VariableValue $SVC_SQL &quot;svc_sql&quot; $true)
        $svc_sql_pwd = (get-globalvariable(&quot;ServiceAccount\$svc_sql&quot;)).value
    }

    log &quot;INFO: admin user = $domain\$user&quot;
    log &quot;INFO: sql user = $domain\$svc_sql&quot;

    $configFile = &quot;$scriptPath\$CONFIG_XML&quot;
    $useDefaultAccts = $USEDEFAULTACCOUNTS
    $instName = $INSTANCENAME
    $sqlFeatures = $FEATURES

    log &quot;INFO: SQL Variables: `nuseDefaultAccts = $useDefaultAccts; `ninstName = $instName; `nsqlFeatures = $sqlFeatures&quot;

    if (ifFileExists( $configFile))
    {
        log &quot;INFO: Found $configFile&quot;
    }
    else
    {
        throw &quot;ERROR: $configFile does not exist&quot;
    }


    # If a parameter hasn't been set, value from the ini file will be used
    # If you have multiple ini files configured, ensure INSTANCENAME doesn't contain any value. 
    # This set of parameters will be applied to ALL configuration ini files that are listed in the config xml

    $parameters = @{}

    if ($useDefaultAccts -eq $true)
    {
        $ISSVCACCOUNT = &quot;NT Service\MsDtsServer110&quot;;

        if (($instName).ToUpper() -eq &quot;MSSQLSERVER&quot;)
        {
            # Default Instance service accounts
            $SQLSVCACCOUNT = &quot;NT Service\MSSQLSERVER&quot;;
            $AGTSVCACCOUNT = &quot;NT Service\SQLSERVERAGENT&quot;;
            $ASSVCACCOUNT = &quot;NT Service\MSSQLServerOLAPService&quot;;
            $RSSVCACCOUNT = &quot;NT Service\ReportServer&quot;
        }
        else
        {
            # Named Instance service accounts
            $SQLSVCACCOUNT = &quot;NT Service\MSSQL&quot; + '$' + $instName
            $AGTSVCACCOUNT = &quot;NT Service\SQLAgent&quot; + '$' + $instName
            $ASSVCACCOUNT = &quot;NT Service\MSOLAP&quot; + '$' + $instName
            $RSSVCACCOUNT = &quot;NT Service\ReportServer&quot; + '$' + $instName
        }

        $parameters.Add(&quot;USEDEFAULTACCOUNTS&quot;, $useDefaultAccts)
        $parameters.Add(&quot;DOMAIN&quot;, $domain)
        $parameters.Add(&quot;SQLSVCACCOUNT&quot;, $SQLSVCACCOUNT)
        $parameters.Add(&quot;AGTSVCACCOUNT&quot;, $AGTSVCACCOUNT)
        $parameters.Add(&quot;ISSVCACCOUNT&quot;, $ISSVCACCOUNT)
        $parameters.Add(&quot;ASSVCACCOUNT&quot;, $ASSVCACCOUNT)
        $parameters.Add(&quot;RSSVCACCOUNT&quot;, $RSSVCACCOUNT)
        $parameters.Add(&quot;SQLSYSADMINACCOUNTS&quot;, &quot;$domain\$user&quot;)
        $parameters.Add(&quot;ASSYSADMINACCOUNTS&quot;, &quot;$domain\$user&quot;)

        if ( !([string]::IsNullOrEmpty($instName ) ) )          
        {
            $parameters.Add(&quot;INSTANCENAME&quot;, $instName)
            $parameters.Add(&quot;INSTANCEID&quot;, $($instName).ToUpper())
            $parameters.Add(&quot;FEATURES&quot;, $sqlFeatures)
            # &quot;PID&quot; = &quot;&quot;; #$LicenseKey is stored in the config.xml
        }
    }
    else
    {
        $parameters.Add(&quot;USEDEFAULTACCOUNTS&quot;, $useDefaultAccts)
        $parameters.Add(&quot;DOMAIN&quot;, $domain)
        $parameters.Add(&quot;SQLSVCACCOUNT&quot;, &quot;$domain\$svc_sql&quot;)
        $parameters.Add(&quot;AGTSVCACCOUNT&quot;, &quot;$domain\$svc_sql&quot;)
        $parameters.Add(&quot;ISSVCACCOUNT&quot;, &quot;$domain\$svc_sql&quot;)
        $parameters.Add(&quot;ASSVCACCOUNT&quot;, &quot;$domain\$svc_sql&quot;)
        $parameters.Add(&quot;RSSVCACCOUNT&quot;, &quot;$domain\$svc_sql&quot;)
        $parameters.Add(&quot;SQLSVCPASSWORD&quot;, $svc_sql_pwd)
        $parameters.Add(&quot;AGTSVCPASSWORD&quot;, $svc_sql_pwd)
        $parameters.Add(&quot;ISSVCPASSWORD&quot;, $svc_sql_pwd)
        $parameters.Add(&quot;ASSVCPASSWORD&quot;, $svc_sql_pwd)
        $parameters.Add(&quot;RSSVCPASSWORD&quot;, $svc_sql_pwd)
        $parameters.Add(&quot;SQLSYSADMINACCOUNTS&quot;, &quot;$domain\$user&quot;)
        $parameters.Add(&quot;ASSYSADMINACCOUNTS&quot;, &quot;$domain\$user&quot;)

        if ( !([string]::IsNullOrEmpty($instName ) )  )        
        {
            $parameters.Add(&quot;INSTANCENAME&quot;, $instName)
            $parameters.Add(&quot;INSTANCEID&quot;, $($instName).ToUpper())
            $parameters.Add(&quot;FEATURES&quot;, $sqlFeatures)
            # &quot;PID&quot; = &quot;&quot;; #$LicenseKey is stored in the config.xml
         }
     }

    $secure_pwd = convertto-securestring $password -asplaintext -force
    $dcred = new-object -typename System.Management.Automation.PSCredential -argumentlist &quot;$domain\$user&quot;, $secure_pwd 

    $msg = &quot;Installing SQL 2012 binaries&quot;
    if ((IfFileExists $configFile) -eq $true)
    {

        # Parse configuration xml and execute configured installs
        log &quot;INFO: Updating configuration file $configFile&quot;
        UpdateSQLConfigurationFiles $configFile $parameters 


        log &quot;INFO: Starting $msg&quot;
        # Execute configured installs
        log &quot;INFO: Executing configuration files&quot;
        ExecuteSQLConfigurationFiles $scriptPath $configFile $dcred $parameters
    }

    log &quot;INFO: Finished $msg. `nExit code $result&quot;
    Write-Host &quot;Script logs: $scriptPath\Logs&quot;
    Write-Host &quot;SQL Installation logs: C:\Program Files\Microsoft SQL Server\110\Setup Bootstrap\Log&quot;

    exit 0
}
catch
{
    $ex = $_.Exception | format-list | Out-String
    log &quot;ERROR: Exception occurred `nException Message: $ex&quot;

    exit 1
} 
</ns1:body>
        <ns1:type>Guest</ns1:type>
        <ns1:language>
            <ns1:name>powershell</ns1:name>
            <ns1:href>scriptlanguage/5</ns1:href>
            <ns1:id>5</ns1:id>
            <ns1:rel>down</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.ScriptLanguage+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:language>
        <ns1:runAsAdmin>false</ns1:runAsAdmin>
        <ns1:timeout>3600</ns1:timeout>
        <ns1:retries>0</ns1:retries>
        <ns1:delay>0</ns1:delay>
        <ns1:errorAction>Continue</ns1:errorAction>
        <ns1:rebootRequired>false</ns1:rebootRequired>
        <ns1:variable>
            <ns1:name>USER</ns1:name>
            <ns1:id>212</ns1:id>
            <ns1:description></ns1:description>
            <ns1:uuid>24bdee5a-2f24-4945-b7d2-62afa3aa815f</ns1:uuid>
            <ns1:top>false</ns1:top>
            <ns1:assetPath></ns1:assetPath>
            <ns1:detailedAssetPath></ns1:detailedAssetPath>
            <ns1:lifecycleVersion>-1</ns1:lifecycleVersion>
            <ns1:removable>true</ns1:removable>
            <ns1:displayName>USER</ns1:displayName>
            <ns1:readable>true</ns1:readable>
            <ns1:writable>true</ns1:writable>
            <ns1:minRequired>0</ns1:minRequired>
            <ns1:maxAllowed>1</ns1:maxAllowed>
            <ns1:validator/>
            <ns1:defaultValue>
                <ns1:id>1976</ns1:id>
                <ns1:name></ns1:name>
                <ns1:encrypted>false</ns1:encrypted>
                <ns1:overridable>true</ns1:overridable>
                <ns1:propertyType>
                    <ns1:name>string-any</ns1:name>
                    <ns1:href>/propertytype/4</ns1:href>
                    <ns1:id>4</ns1:id>
                    <ns1:rel>up</ns1:rel>
                    <ns1:type>application/com.servicemesh.agility.api.PropertyType+xml</ns1:type>
                    <ns1:position>0</ns1:position>
                </ns1:propertyType>
                <ns1:stringValue>agilitydeploy</ns1:stringValue>
            </ns1:defaultValue>
            <ns1:propertyType>
                <ns1:name>string-any</ns1:name>
                <ns1:href>propertytype/4</ns1:href>
                <ns1:id>4</ns1:id>
                <ns1:type>application/com.servicemesh.agility.api.PropertyType+xml</ns1:type>
            </ns1:propertyType>
            <ns1:assetPropertyLinkId>d084c404-eda3-4a01-b9b9-37f47fe4346b</ns1:assetPropertyLinkId>
        </ns1:variable>
        <ns1:variable>
            <ns1:name>FEATURES</ns1:name>
            <ns1:id>213</ns1:id>
            <ns1:uuid>d4f8b329-0577-473a-be3a-c8f66368b524</ns1:uuid>
            <ns1:top>false</ns1:top>
            <ns1:assetPath></ns1:assetPath>
            <ns1:detailedAssetPath></ns1:detailedAssetPath>
            <ns1:lifecycleVersion>-1</ns1:lifecycleVersion>
            <ns1:removable>true</ns1:removable>
            <ns1:readable>true</ns1:readable>
            <ns1:writable>true</ns1:writable>
            <ns1:minRequired>0</ns1:minRequired>
            <ns1:maxAllowed>0</ns1:maxAllowed>
            <ns1:propertyType>
                <ns1:name>string-any</ns1:name>
                <ns1:href>propertytype/4</ns1:href>
                <ns1:id>4</ns1:id>
                <ns1:type>application/com.servicemesh.agility.api.PropertyType+xml</ns1:type>
            </ns1:propertyType>
            <ns1:assetPropertyLinkId>87f6c118-4b40-4e4f-9821-fc9daabe1a7d</ns1:assetPropertyLinkId>
        </ns1:variable>
        <ns1:variable>
            <ns1:name>INSTANCENAME</ns1:name>
            <ns1:id>214</ns1:id>
            <ns1:uuid>9d45839f-ff75-43b8-9de6-f84080920238</ns1:uuid>
            <ns1:top>false</ns1:top>
            <ns1:assetPath></ns1:assetPath>
            <ns1:detailedAssetPath></ns1:detailedAssetPath>
            <ns1:lifecycleVersion>-1</ns1:lifecycleVersion>
            <ns1:removable>true</ns1:removable>
            <ns1:readable>true</ns1:readable>
            <ns1:writable>true</ns1:writable>
            <ns1:minRequired>0</ns1:minRequired>
            <ns1:maxAllowed>0</ns1:maxAllowed>
            <ns1:propertyType>
                <ns1:name>string-any</ns1:name>
                <ns1:href>propertytype/4</ns1:href>
                <ns1:id>4</ns1:id>
                <ns1:type>application/com.servicemesh.agility.api.PropertyType+xml</ns1:type>
            </ns1:propertyType>
            <ns1:assetPropertyLinkId>9db2aabf-a66f-4521-ab58-4bfe270f1137</ns1:assetPropertyLinkId>
        </ns1:variable>
        <ns1:variable>
            <ns1:name>USEDEFAULTACCOUNTS</ns1:name>
            <ns1:id>215</ns1:id>
            <ns1:description></ns1:description>
            <ns1:uuid>6b4f4403-49f5-40f8-8a10-c96a8ef1fd31</ns1:uuid>
            <ns1:top>false</ns1:top>
            <ns1:assetPath></ns1:assetPath>
            <ns1:detailedAssetPath></ns1:detailedAssetPath>
            <ns1:lifecycleVersion>-1</ns1:lifecycleVersion>
            <ns1:removable>true</ns1:removable>
            <ns1:displayName>USEDEFAULTACCOUNTS</ns1:displayName>
            <ns1:readable>true</ns1:readable>
            <ns1:writable>true</ns1:writable>
            <ns1:minRequired>0</ns1:minRequired>
            <ns1:maxAllowed>1</ns1:maxAllowed>
            <ns1:validator/>
            <ns1:defaultValue>
                <ns1:id>1977</ns1:id>
                <ns1:name></ns1:name>
                <ns1:encrypted>false</ns1:encrypted>
                <ns1:overridable>true</ns1:overridable>
                <ns1:propertyType>
                    <ns1:name>boolean</ns1:name>
                    <ns1:href>/propertytype/9</ns1:href>
                    <ns1:id>9</ns1:id>
                    <ns1:rel>up</ns1:rel>
                    <ns1:type>application/com.servicemesh.agility.api.PropertyType+xml</ns1:type>
                    <ns1:position>0</ns1:position>
                </ns1:propertyType>
                <ns1:booleanValue>false</ns1:booleanValue>
            </ns1:defaultValue>
            <ns1:propertyType>
                <ns1:name>boolean</ns1:name>
                <ns1:href>propertytype/9</ns1:href>
                <ns1:id>9</ns1:id>
                <ns1:type>application/com.servicemesh.agility.api.PropertyType+xml</ns1:type>
            </ns1:propertyType>
            <ns1:assetPropertyLinkId>1548f46f-1c09-4192-8592-4ba159c58eea</ns1:assetPropertyLinkId>
        </ns1:variable>
        <ns1:variable>
            <ns1:name>CONFIG_XML</ns1:name>
            <ns1:id>216</ns1:id>
            <ns1:description></ns1:description>
            <ns1:uuid>faaae13a-61b6-4a17-a235-d76b467c5b1c</ns1:uuid>
            <ns1:top>false</ns1:top>
            <ns1:assetPath></ns1:assetPath>
            <ns1:detailedAssetPath></ns1:detailedAssetPath>
            <ns1:lifecycleVersion>-1</ns1:lifecycleVersion>
            <ns1:removable>true</ns1:removable>
            <ns1:displayName>CONFIG_XML</ns1:displayName>
            <ns1:readable>true</ns1:readable>
            <ns1:writable>true</ns1:writable>
            <ns1:minRequired>0</ns1:minRequired>
            <ns1:maxAllowed>1</ns1:maxAllowed>
            <ns1:validator/>
            <ns1:propertyType>
                <ns1:name>CONFIG_XML_localValue</ns1:name>
                <ns1:href>propertytype/44</ns1:href>
                <ns1:id>44</ns1:id>
                <ns1:type>application/com.servicemesh.agility.api.PropertyType+xml</ns1:type>
            </ns1:propertyType>
            <ns1:propertyTypeValue>
                <ns1:name>CONFIG_XML_localValue</ns1:name>
                <ns1:id>44</ns1:id>
                <ns1:uuid>b5352682-adc9-4ac8-98c6-27c8a8cf7439</ns1:uuid>
                <ns1:assetType>
                    <ns1:name>propertytype</ns1:name>
                    <ns1:href>assettype/48</ns1:href>
                    <ns1:id>48</ns1:id>
                    <ns1:rel>up</ns1:rel>
                    <ns1:type>application/com.servicemesh.agility.api.AssetType+xml</ns1:type>
                    <ns1:position>0</ns1:position>
                </ns1:assetType>
                <ns1:top>false</ns1:top>
                <ns1:assetPath></ns1:assetPath>
                <ns1:detailedAssetPath></ns1:detailedAssetPath>
                <ns1:lifecycleVersion>-1</ns1:lifecycleVersion>
                <ns1:removable>true</ns1:removable>
                <ns1:displayName>CONFIG_XML</ns1:displayName>
                <ns1:type>string</ns1:type>
                <ns1:open>false</ns1:open>
                <ns1:valueConstraint>list</ns1:valueConstraint>
                <ns1:rootValue>
                    <ns1:name>SQL2012SP1Std_SharePoint.xml</ns1:name>
                    <ns1:id>197</ns1:id>
                    <ns1:uuid>926a5fca-821d-4f4f-826e-4e9d3b6136ce</ns1:uuid>
                    <ns1:top>false</ns1:top>
                    <ns1:assetPath></ns1:assetPath>
                    <ns1:detailedAssetPath></ns1:detailedAssetPath>
                    <ns1:lifecycleVersion>-1</ns1:lifecycleVersion>
                    <ns1:removable>true</ns1:removable>
                    <ns1:displayName>SQL2012SP1Std_SharePoint.xml</ns1:displayName>
                    <ns1:value>SQL2012SP1Std_SharePoint.xml</ns1:value>
                </ns1:rootValue>
                <ns1:owned>true</ns1:owned>
            </ns1:propertyTypeValue>
            <ns1:assetPropertyLinkId>926468e9-2833-41cc-948c-2946006c97c8</ns1:assetPropertyLinkId>
        </ns1:variable>
        <ns1:runOnProvisionOnly>false</ns1:runOnProvisionOnly>
    </ns1:pendingAsset>
    <ns1:pendingAsset xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="ns1:Script">
        <ns1:name>MWS2R2 - AD Add To Domain</ns1:name>
        <ns1:id>233</ns1:id>
        <ns1:description></ns1:description>
        <ns1:uuid>610a72d9-8165-4970-86f0-58ba43b6d6f3</ns1:uuid>
        <ns1:assetType>
            <ns1:name>script</ns1:name>
            <ns1:href>assettype/2</ns1:href>
            <ns1:id>2</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.AssetType+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:assetType>
        <ns1:top>false</ns1:top>
        <ns1:assetPath>/Root/MWS2/MWS2_CDCR2</ns1:assetPath>
        <ns1:detailedAssetPath>/Root:#ID#1:#TYPE#VMContainer/MWS2:#ID#8:#TYPE#VMContainer/MWS2_CDCR2:#ID#9:#TYPE#VMProject</ns1:detailedAssetPath>
        <ns1:lifecycleVersion>-1</ns1:lifecycleVersion>
        <ns1:removable>true</ns1:removable>
        <ns1:domain>
            <ns1:name>domain1</ns1:name>
            <ns1:href>domain/1</ns1:href>
            <ns1:id>1</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.Domain+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:domain>
        <ns1:creator>
            <ns1:name>mfreeman</ns1:name>
            <ns1:href>user/12</ns1:href>
            <ns1:id>12</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.User+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:creator>
        <ns1:created>2015-04-16T20:07:22-05:00</ns1:created>
        <ns1:lockType>0</ns1:lockType>
        <ns1:lastModified>2015-04-16T20:12:30-05:00</ns1:lastModified>
        <ns1:parent>
            <ns1:name>MWS2_CDCR2</ns1:name>
            <ns1:href>project/9</ns1:href>
            <ns1:id>9</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.Project+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:parent>
        <ns1:slot>d24bbade-b665-4ced-bb6a-397057153d30</ns1:slot>
        <ns1:version>2</ns1:version>
        <ns1:latest>true</ns1:latest>
        <ns1:publishComment></ns1:publishComment>
        <ns1:slotId>188</ns1:slotId>
        <ns1:publisher>
            <ns1:name>mfreeman</ns1:name>
            <ns1:href>user/12</ns1:href>
            <ns1:id>12</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.User+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:publisher>
        <ns1:versionStatus>active_checkedout</ns1:versionStatus>
        <ns1:checkoutAllowed>true</ns1:checkoutAllowed>
        <ns1:headAllowed>false</ns1:headAllowed>
        <ns1:operatingSystem>Windows</ns1:operatingSystem>
        <ns1:enableExtensions>false</ns1:enableExtensions>
        <ns1:body>#	ScriptName: 	AD Add to Domain
#	Author: 	Mark Freeman
#	Required Variables: None
#	Description:
#
#	Adds a computer to the MWS2 Resource Domain


. .\GlobalRepository.ps1

$domainname = (get-globalvariable &quot;Global\DomainFQDN&quot;).value
$domainNB = (get-globalvariable &quot;Global\DomainNetBIOS&quot;).value
$short_username = (get-globalvariable &quot;Global\DeploymentUsername&quot;).value
$username = &quot;$domainNB\$short_username&quot;
$password = (get-globalvariable &quot;Global\DeploymentPassword&quot;).value
$dn = (get-globalvariable &quot;AD\DistinguishedName&quot;).value

$pdns = (get-globalvariable &quot;AD\PrimaryDNS&quot;).value
$sdns = (get-globalvariable &quot;AD\SecondaryDNS&quot;).value

$computername = $env:COMPUTERNAME
$ouPath = &quot;OU=servers,OU=customer,$dn&quot;

if ($computername.ToLower().Contains(&quot;dbs&quot;)){
    $ouPath=&quot;OU=Database,$ouPath&quot;
}

if ($computername.ToLower().Contains(&quot;mas&quot;)){
    $ouPath=&quot;OU=Exchange,$ouPath&quot;
}

$na=Get-NetAdapter -Physical | where status -eq 'up'
Set-DnsClientServerAddress -InterfaceIndex $na.ifIndex -ServerAddresses ($pdns,$sdns)

$secure_pwd = convertto-securestring $password -asplaintext -force
$djcred = new-object -typename System.Management.Automation.PSCredential `
         -argumentlist $username, $secure_pwd

Add-Computer -DomainName $domainname -Credential $djcred -OUPath $ouPath -Force
write-output &quot;Joined domain.&quot;


</ns1:body>
        <ns1:type>Guest</ns1:type>
        <ns1:language>
            <ns1:name>powershell</ns1:name>
            <ns1:href>scriptlanguage/5</ns1:href>
            <ns1:id>5</ns1:id>
            <ns1:rel>down</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.ScriptLanguage+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:language>
        <ns1:runAsAdmin>false</ns1:runAsAdmin>
        <ns1:timeout>3600</ns1:timeout>
        <ns1:retries>0</ns1:retries>
        <ns1:delay>0</ns1:delay>
        <ns1:errorAction>Continue</ns1:errorAction>
        <ns1:rebootRequired>true</ns1:rebootRequired>
        <ns1:runOnProvisionOnly>false</ns1:runOnProvisionOnly>
    </ns1:pendingAsset>
    <ns1:pendingAsset xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="ns1:Script">
        <ns1:name>MWS2R2 - AD Rename Computer</ns1:name>
        <ns1:id>235</ns1:id>
        <ns1:description></ns1:description>
        <ns1:uuid>a1b59773-1b5c-4917-8545-380007f6690a</ns1:uuid>
        <ns1:assetType>
            <ns1:name>script</ns1:name>
            <ns1:href>assettype/2</ns1:href>
            <ns1:id>2</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.AssetType+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:assetType>
        <ns1:top>false</ns1:top>
        <ns1:assetPath>/Root/MWS2/MWS2_CDCR2</ns1:assetPath>
        <ns1:detailedAssetPath>/Root:#ID#1:#TYPE#VMContainer/MWS2:#ID#8:#TYPE#VMContainer/MWS2_CDCR2:#ID#9:#TYPE#VMProject</ns1:detailedAssetPath>
        <ns1:lifecycleVersion>-1</ns1:lifecycleVersion>
        <ns1:removable>true</ns1:removable>
        <ns1:domain>
            <ns1:name>domain1</ns1:name>
            <ns1:href>domain/1</ns1:href>
            <ns1:id>1</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.Domain+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:domain>
        <ns1:creator>
            <ns1:name>mfreeman</ns1:name>
            <ns1:href>user/12</ns1:href>
            <ns1:id>12</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.User+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:creator>
        <ns1:created>2015-04-16T20:07:22-05:00</ns1:created>
        <ns1:lockType>0</ns1:lockType>
        <ns1:lastModified>2015-04-16T20:12:42-05:00</ns1:lastModified>
        <ns1:parent>
            <ns1:name>MWS2_CDCR2</ns1:name>
            <ns1:href>project/9</ns1:href>
            <ns1:id>9</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.Project+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:parent>
        <ns1:slot>c81389ef-c101-4448-a7e4-1804b50696c2</ns1:slot>
        <ns1:version>2</ns1:version>
        <ns1:latest>false</ns1:latest>
        <ns1:publishComment></ns1:publishComment>
        <ns1:slotId>187</ns1:slotId>
        <ns1:publisher>
            <ns1:name>mfreeman</ns1:name>
            <ns1:href>user/12</ns1:href>
            <ns1:id>12</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.User+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:publisher>
        <ns1:versionStatus>versioned</ns1:versionStatus>
        <ns1:checkoutAllowed>true</ns1:checkoutAllowed>
        <ns1:headAllowed>true</ns1:headAllowed>
        <ns1:operatingSystem>Windows</ns1:operatingSystem>
        <ns1:enableExtensions>false</ns1:enableExtensions>
        <ns1:body>#	ScriptName: 	AD Rename Computer
#	Author: 	Mark Freeman
#	Required Variables: COMPONENTID, INSTANCEID
#	Description:
#
#	Renames a computer based on MWS2 naming standard
#	Registers the computername and IP address in the key value store
#	Downloads common and computer specific files from the deployment file share
#	Resets the local administrator account password to a random value
#	Registers the password in the key value share
#	Updates the instance name in AWS


. .\GlobalRepository.ps1


$ComponentID = $COMPONENTID
$InstanceID =  $INSTANCEID

$CustomerID = (get-globalvariable &quot;Global/CustomerID&quot;).value
$LocationID = (get-globalvariable &quot;Global/LocationID&quot;).value

$Computername = $($CustomerID + $ComponentID + $LocationID + $InstanceID + &quot;W&quot;)
write-output &quot;Setting computername to $Computername&quot;
Rename-Computer -NewName $Computername -force

write-output &quot;Storing IP Address in key value store&quot;
$key = 'Network/{0}' -f $Computername
$ip = Get-NetIPAddress | Where-Object -FilterScript {$_.AddressFamily -eq &quot;IPv4&quot; } | Where-Object -FilterScript {$_.IPAddress -ne &quot;127.0.0.1&quot;}
$ipa = $ip.IPAddress
Set-globalvariable $key $ipa

write-output &quot;Downloading common files and computer files from repository&quot;

get-files &quot;$ComponentID$InstanceID&quot;

write-output &quot;Resetting local administrator password&quot;
. .\New-RandomPassword.ps1
$password = new-randompassword -PasswordLength 10
$adminUser = [ADSI] &quot;WinNT://./SOE-LOAD,User&quot;
$adminUser.SetPassword($password)
Set-globalvariable &quot;Administrator/$Computername&quot; $password

#register name tag
#write-output &quot;Registering AWS name tag&quot;
#$aid  = Invoke-RestMethod -Uri http://169.254.169.254/latest/meta-data/instance-id
#$uri = &quot;http://10.0.0.23:5000/p1/&quot; + $aid + &quot;?tagname=&quot; + $Computername 
#Invoke-RestMethod -Uri $uri -Method Put


write-output &quot;Restarting computer&quot;

</ns1:body>
        <ns1:type>Guest</ns1:type>
        <ns1:language>
            <ns1:name>powershell</ns1:name>
            <ns1:href>scriptlanguage/5</ns1:href>
            <ns1:id>5</ns1:id>
            <ns1:rel>down</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.ScriptLanguage+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:language>
        <ns1:runAsAdmin>false</ns1:runAsAdmin>
        <ns1:timeout>3600</ns1:timeout>
        <ns1:retries>0</ns1:retries>
        <ns1:delay>0</ns1:delay>
        <ns1:errorAction>Continue</ns1:errorAction>
        <ns1:rebootRequired>true</ns1:rebootRequired>
        <ns1:variable>
            <ns1:name>COMPONENTID</ns1:name>
            <ns1:id>388</ns1:id>
            <ns1:description>COMPONENTID</ns1:description>
            <ns1:uuid>fda4b5c4-7fde-4182-af5f-0e74e2cb55c0</ns1:uuid>
            <ns1:top>false</ns1:top>
            <ns1:assetPath></ns1:assetPath>
            <ns1:detailedAssetPath></ns1:detailedAssetPath>
            <ns1:lifecycleVersion>-1</ns1:lifecycleVersion>
            <ns1:removable>true</ns1:removable>
            <ns1:displayName>COMPONENTID</ns1:displayName>
            <ns1:readable>true</ns1:readable>
            <ns1:writable>true</ns1:writable>
            <ns1:minRequired>0</ns1:minRequired>
            <ns1:maxAllowed>1</ns1:maxAllowed>
            <ns1:validator/>
            <ns1:propertyType>
                <ns1:name>string-any</ns1:name>
                <ns1:href>propertytype/4</ns1:href>
                <ns1:id>4</ns1:id>
                <ns1:type>application/com.servicemesh.agility.api.PropertyType+xml</ns1:type>
            </ns1:propertyType>
            <ns1:assetPropertyLinkId>de0200c9-8810-412c-8fd6-0c33775f9bdb</ns1:assetPropertyLinkId>
        </ns1:variable>
        <ns1:variable>
            <ns1:name>INSTANCEID</ns1:name>
            <ns1:id>389</ns1:id>
            <ns1:description>INSTANCEID</ns1:description>
            <ns1:uuid>bfb6a426-e97b-43a0-a48a-70417f30f8eb</ns1:uuid>
            <ns1:top>false</ns1:top>
            <ns1:assetPath></ns1:assetPath>
            <ns1:detailedAssetPath></ns1:detailedAssetPath>
            <ns1:lifecycleVersion>-1</ns1:lifecycleVersion>
            <ns1:removable>true</ns1:removable>
            <ns1:displayName>INSTANCEID</ns1:displayName>
            <ns1:readable>true</ns1:readable>
            <ns1:writable>true</ns1:writable>
            <ns1:minRequired>0</ns1:minRequired>
            <ns1:maxAllowed>1</ns1:maxAllowed>
            <ns1:validator/>
            <ns1:propertyType>
                <ns1:name>string-any</ns1:name>
                <ns1:href>propertytype/4</ns1:href>
                <ns1:id>4</ns1:id>
                <ns1:type>application/com.servicemesh.agility.api.PropertyType+xml</ns1:type>
            </ns1:propertyType>
            <ns1:assetPropertyLinkId>24d648a9-5594-414a-8982-443a1d37910d</ns1:assetPropertyLinkId>
        </ns1:variable>
        <ns1:runOnProvisionOnly>false</ns1:runOnProvisionOnly>
    </ns1:pendingAsset>
    <ns1:Asset xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="ns1:Package">
        <ns1:name>MWS2R2 - SharePoint SQL Install</ns1:name>
        <ns1:id>41</ns1:id>
        <ns1:description></ns1:description>
        <ns1:uuid>a14523fe-019a-4104-823c-977fda6feef9</ns1:uuid>
        <ns1:assetType>
            <ns1:name>package</ns1:name>
            <ns1:href>assettype/3</ns1:href>
            <ns1:id>3</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.AssetType+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:assetType>
        <ns1:top>true</ns1:top>
        <ns1:assetPath>/Root/MWS2/MWS2_CDCR2</ns1:assetPath>
        <ns1:detailedAssetPath>/Root:#ID#1:#TYPE#VMContainer/MWS2:#ID#8:#TYPE#VMContainer/MWS2_CDCR2:#ID#9:#TYPE#VMProject</ns1:detailedAssetPath>
        <ns1:lifecycleVersion>-1</ns1:lifecycleVersion>
        <ns1:removable>true</ns1:removable>
        <ns1:domain>
            <ns1:name>domain1</ns1:name>
            <ns1:href>domain/1</ns1:href>
            <ns1:id>1</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.Domain+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:domain>
        <ns1:creator>
            <ns1:name>mkrynina</ns1:name>
            <ns1:href>user/6</ns1:href>
            <ns1:id>6</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.User+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:creator>
        <ns1:created>2015-02-17T05:09:20-06:00</ns1:created>
        <ns1:lockType>0</ns1:lockType>
        <ns1:lastModified>2015-05-04T04:39:10-05:00</ns1:lastModified>
        <ns1:parent>
            <ns1:name>MWS2_CDCR2</ns1:name>
            <ns1:href>project/9</ns1:href>
            <ns1:id>9</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.Project+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:parent>
        <ns1:version>-1</ns1:version>
        <ns1:latest>false</ns1:latest>
        <ns1:versionStatus>inprogress</ns1:versionStatus>
        <ns1:checkoutAllowed>false</ns1:checkoutAllowed>
        <ns1:headAllowed>false</ns1:headAllowed>
        <ns1:operatingSystem>Windows</ns1:operatingSystem>
        <ns1:install>
            <ns1:name>MWS2R2 - Get App Files</ns1:name>
            <ns1:href>script/145</ns1:href>
            <ns1:id>244</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.Script+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:install>
        <ns1:install>
            <ns1:name>MWS2R2 - Extract App Files</ns1:name>
            <ns1:href>script/146</ns1:href>
            <ns1:id>245</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.Script+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:install>
        <ns1:operational>
            <ns1:name>MWS2R2 - Get App Files</ns1:name>
            <ns1:href>script/145</ns1:href>
            <ns1:id>244</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.Script+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:operational>
        <ns1:operational>
            <ns1:name>MWS2R2 - Extract App Files</ns1:name>
            <ns1:href>script/146</ns1:href>
            <ns1:id>245</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.Script+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:operational>
        <ns1:operational>
            <ns1:name>MWS2R2 - SharePoint SQL2012SP1Std install</ns1:name>
            <ns1:href>script/152</ns1:href>
            <ns1:id>152</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.Script+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:operational>
        <ns1:operational>
            <ns1:name>MWS2R2 - AD Add To Domain</ns1:name>
            <ns1:href>script/233</ns1:href>
            <ns1:id>233</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.Script+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:operational>
        <ns1:operational>
            <ns1:name>MWS2R2 - AD Rename Computer</ns1:name>
            <ns1:href>script/235</ns1:href>
            <ns1:id>235</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.Script+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:operational>
    </ns1:Asset>
</ns1:Envelope>
