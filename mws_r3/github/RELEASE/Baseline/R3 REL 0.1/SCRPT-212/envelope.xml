<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<ns1:Envelope xmlns:ns1="http://servicemesh.com/agility/api" xmlns:ns2="http://servicemesh.com/core/messaging" ns1:version="3.0" ns1:productVersion="9.2.4">
    <ns1:Asset xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="ns1:Script">
        <ns1:name>MWS2R2 - Wait For Reboot</ns1:name>
        <ns1:id>212</ns1:id>
        <ns1:description></ns1:description>
        <ns1:uuid>75058de8-d67c-4365-9e72-e1520c0ee3aa</ns1:uuid>
        <ns1:assetType>
            <ns1:name>script</ns1:name>
            <ns1:href>assettype/2</ns1:href>
            <ns1:id>2</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.AssetType+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:assetType>
        <ns1:top>true</ns1:top>
        <ns1:assetPath>/Root/MWS2/MWS2_CDCR2</ns1:assetPath>
        <ns1:detailedAssetPath>/Root:#ID#1:#TYPE#VMContainer/MWS2:#ID#8:#TYPE#VMContainer/MWS2_CDCR2:#ID#9:#TYPE#VMProject</ns1:detailedAssetPath>
        <ns1:lifecycleVersion>-1</ns1:lifecycleVersion>
        <ns1:removable>true</ns1:removable>
        <ns1:domain>
            <ns1:name>domain1</ns1:name>
            <ns1:href>domain/1</ns1:href>
            <ns1:id>1</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.Domain+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:domain>
        <ns1:creator>
            <ns1:name>rsparkes</ns1:name>
            <ns1:href>user/15</ns1:href>
            <ns1:id>15</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.User+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:creator>
        <ns1:created>2015-03-09T22:03:18-05:00</ns1:created>
        <ns1:lockType>0</ns1:lockType>
        <ns1:lastModified>2015-03-30T21:53:22-05:00</ns1:lastModified>
        <ns1:parent>
            <ns1:name>MWS2_CDCR2</ns1:name>
            <ns1:href>project/9</ns1:href>
            <ns1:id>9</ns1:id>
            <ns1:rel>up</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.Project+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:parent>
        <ns1:version>-1</ns1:version>
        <ns1:latest>false</ns1:latest>
        <ns1:versionStatus>inprogress</ns1:versionStatus>
        <ns1:checkoutAllowed>false</ns1:checkoutAllowed>
        <ns1:headAllowed>false</ns1:headAllowed>
        <ns1:operatingSystem>Windows</ns1:operatingSystem>
        <ns1:enableExtensions>false</ns1:enableExtensions>
        <ns1:body>Write-Host &quot;Checking for a reboot...&quot;
write-output (get-date).ToLongTimeString()

$StartTime = Get-Date

$Timeout = $TIMEOUT

$MatchString = &quot;The process (.+) has initiated the restart of computer .+ on behalf of .+ for the following reason: (.+)&quot;
Do {
	$LastLogs = Get-EventLog System -After (Get-Date).AddMinutes(-2)
	ForEach ($E in $LastLogs) {
		If ($E.Message -Match $MatchString) {
			Write-Host &quot;Server rebooting. Event found at $($E.TimeGenerated.ToString()):&quot;
			Write-Host $E.Message
			Exit 0
		}
	}
} While ((Get-Date).AddMinutes($Timeout) -gt $StartTime)

Write-Host &quot;Waited for $Timeout minutes - No reboot detected&quot;
Exit 0</ns1:body>
        <ns1:type>Guest</ns1:type>
        <ns1:language>
            <ns1:name>powershell</ns1:name>
            <ns1:href>scriptlanguage/5</ns1:href>
            <ns1:id>5</ns1:id>
            <ns1:rel>down</ns1:rel>
            <ns1:type>application/com.servicemesh.agility.api.ScriptLanguage+xml</ns1:type>
            <ns1:position>0</ns1:position>
        </ns1:language>
        <ns1:runAsAdmin>false</ns1:runAsAdmin>
        <ns1:timeout>3600</ns1:timeout>
        <ns1:retries>5</ns1:retries>
        <ns1:delay>60</ns1:delay>
        <ns1:errorAction>Continue</ns1:errorAction>
        <ns1:rebootRequired>false</ns1:rebootRequired>
        <ns1:variable>
            <ns1:name>TIMEOUT</ns1:name>
            <ns1:id>294</ns1:id>
            <ns1:description>Override the default timeout of 10 minutes to wait.</ns1:description>
            <ns1:uuid>2494c155-77d6-4fcf-a908-1b391f2e08ec</ns1:uuid>
            <ns1:top>false</ns1:top>
            <ns1:assetPath></ns1:assetPath>
            <ns1:detailedAssetPath></ns1:detailedAssetPath>
            <ns1:lifecycleVersion>-1</ns1:lifecycleVersion>
            <ns1:removable>true</ns1:removable>
            <ns1:displayName>TIMEOUT</ns1:displayName>
            <ns1:readable>true</ns1:readable>
            <ns1:writable>true</ns1:writable>
            <ns1:minRequired>0</ns1:minRequired>
            <ns1:maxAllowed>60</ns1:maxAllowed>
            <ns1:validator>
                <ns1:NumericRangeValidator>
                    <ns1:top>false</ns1:top>
                </ns1:NumericRangeValidator>
                <ns1:NumericScaleValidator>
                    <ns1:top>false</ns1:top>
                    <ns1:maxDigits>62</ns1:maxDigits>
                    <ns1:maxFractions>2</ns1:maxFractions>
                </ns1:NumericScaleValidator>
            </ns1:validator>
            <ns1:defaultValue>
                <ns1:id>7351</ns1:id>
                <ns1:name></ns1:name>
                <ns1:encrypted>false</ns1:encrypted>
                <ns1:overridable>true</ns1:overridable>
                <ns1:propertyType>
                    <ns1:name>numeric-any</ns1:name>
                    <ns1:href>/propertytype/3</ns1:href>
                    <ns1:id>3</ns1:id>
                    <ns1:rel>up</ns1:rel>
                    <ns1:type>application/com.servicemesh.agility.api.PropertyType+xml</ns1:type>
                    <ns1:position>0</ns1:position>
                </ns1:propertyType>
                <ns1:floatValue>10.00</ns1:floatValue>
            </ns1:defaultValue>
            <ns1:propertyType>
                <ns1:name>numeric-any</ns1:name>
                <ns1:href>propertytype/3</ns1:href>
                <ns1:id>3</ns1:id>
                <ns1:type>application/com.servicemesh.agility.api.PropertyType+xml</ns1:type>
            </ns1:propertyType>
            <ns1:assetPropertyLinkId>1ff373be-fb55-4c92-99b0-71edcedce8bf</ns1:assetPropertyLinkId>
        </ns1:variable>
        <ns1:runOnProvisionOnly>false</ns1:runOnProvisionOnly>
    </ns1:Asset>
</ns1:Envelope>
